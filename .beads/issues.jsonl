{"id":"homeassistant_adguard_home-00j","title":"Add DNS cache switch entity","description":"## Problem\nAdGuard Home v0.107.65+ has DNS cache control via API, but no entity exposes this functionality.\n\n## Research\nFrom AdGuard Home v0.107.65 release notes (August 20, 2025):\n\u003e Added a separate checkbox in the Web UI to enable or disable the global DNS response cache without losing the configured cache size.\n\u003e Added a new \"cache_enabled\" field to the HTTP API (GET /control/dns_info and POST /control/dns_config).\n\nThe API client already has \\`get_dns_info()\\` and \\`set_dns_cache_enabled()\\` methods.\n\n## Fix Required\nAdd new switch entity description in switch.py:\n\\`\\`\\`python\nAdGuardHomeSwitchEntityDescription(\n    key=\"dns_cache\",\n    translation_key=\"dns_cache\",\n    icon=\"mdi:cached\",\n    is_on_fn=lambda data: data.dns_info.get(\"cache_enabled\") if data.dns_info else None,\n    turn_on_fn=lambda client: client.set_dns_cache_enabled(True),\n    turn_off_fn=lambda client: client.set_dns_cache_enabled(False),\n),\n\\`\\`\\`\n\nAlso add translation key in strings.json.\n\n## Dependencies\n- Requires: Add DNS info fetch to coordinator (homeassistant_adguard_home-nj6)\n\n## Files Affected\n- custom_components/adguard_home_extended/switch.py\n- custom_components/adguard_home_extended/strings.json\n- custom_components/adguard_home_extended/translations/en.json","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-17T18:39:02.24961-05:00","updated_at":"2025-12-17T18:48:46.597532-05:00","closed_at":"2025-12-17T18:48:46.597532-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-00j","depends_on_id":"homeassistant_adguard_home-nj6","type":"blocks","created_at":"2025-12-17T18:39:06.455944-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-04e","title":"Support DNS rewrite enabled field (v0.107.68+)","description":"## Background\nAdGuard Home v0.107.68 (Oct 2025) added the ability to enable/disable individual DNS rewrite rules without deleting them. This is documented in the OpenAPI changelog.\n\n## Research Findings (Dec 17, 2025)\nFrom AdGuard Home API CHANGELOG.md:\n- v0.107.68+: DNS rewrite rules now support an \\`enabled\\` field\n- This allows toggling rules on/off without CRUD operations\n- The integration currently only supports add/delete operations\n\n## Current Implementation\n\\`\\`\\`python\n# api/models.py - DnsRewrite class\n@dataclass\nclass DnsRewrite:\n    domain: str\n    answer: str\n    # Missing: enabled field\n\\`\\`\\`\n\n## Proposed Changes\n\n### 1. Update DnsRewrite model\n\\`\\`\\`python\n@dataclass\nclass DnsRewrite:\n    domain: str\n    answer: str\n    enabled: bool = True  # New in v0.107.68\n\\`\\`\\`\n\n### 2. Add toggle method to API client\n\\`\\`\\`python\nasync def set_rewrite_enabled(self, domain: str, answer: str, enabled: bool) -\u003e None:\n    \"\"\"Enable or disable a DNS rewrite rule (v0.107.68+).\"\"\"\n    await self._put(API_REWRITE_UPDATE, {\n        \"target\": {\"domain\": domain, \"answer\": answer},\n        \"update\": {\"domain\": domain, \"answer\": answer, \"enabled\": enabled}\n    })\n\\`\\`\\`\n\n### 3. Update switch entities\n- DNS rewrite switches should toggle \\`enabled\\` instead of create/delete\n- Add version check: only use enabled field for v0.107.68+\n\n## Files to Modify\n- \\`custom_components/adguard_home_extended/api/models.py\\`\n- \\`custom_components/adguard_home_extended/api/client.py\\`\n- \\`custom_components/adguard_home_extended/switch.py\\` (DnsRewriteSwitch)\n- \\`tests/test_dns_rewrite.py\\`\n\n## Acceptance Criteria\n- [ ] DnsRewrite model includes enabled field\n- [ ] API client can toggle rewrite enabled state\n- [ ] Version check ensures backward compatibility with \u003c0.107.68\n- [ ] Switch entities use enabled toggle for v0.107.68+","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T21:09:59.529595-05:00","updated_at":"2025-12-17T21:14:52.921193-05:00","closed_at":"2025-12-17T21:14:52.921193-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-04e","depends_on_id":"homeassistant_adguard_home-a43","type":"blocks","created_at":"2025-12-17T21:10:31.128429-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-0aj","title":"Add sensor.py state/attribute tests","description":"## Coverage Gap\n\\`sensor.py\\` has 65% coverage (14 lines missing).\n\n## Missing Coverage\nLines 28, 286-288, 307-310, 315, 320-330\n\n### Key Untested Areas\n- Some sensor native_value methods\n- Sensor extra_state_attributes methods\n- Edge cases in attribute formatting\n\n## Test Cases Needed\n1. test_sensor_native_value_edge_cases\n2. test_sensor_attributes_empty_data\n3. test_sensor_attributes_formatting\n4. test_dns_config_sensors_state\n\n## Files to Modify\n- \\`tests/test_sensor.py\\`\n\n## Acceptance Criteria\n- [ ] All sensor state methods tested\n- [ ] Attribute edge cases covered\n- [ ] Empty/null data handling tested","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:21:42.500717-05:00","updated_at":"2025-12-17T21:33:02.614312-05:00","closed_at":"2025-12-17T21:33:02.614312-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-0aj","depends_on_id":"homeassistant_adguard_home-x5q","type":"blocks","created_at":"2025-12-17T21:22:14.952053-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-0c9","title":"Add service translations to strings.json","description":"## Problem\nThe integration has 11 services defined in \\`services.yaml\\` with names and descriptions, but these are not properly translated in \\`strings.json\\`. Home Assistant expects service translations under a \\`services\\` key for proper localization.\n\n## Research Findings (Dec 17, 2025)\n- Home Assistant 2025.x requires service translations for proper UI display\n- The \\`services.yaml\\` file defines the schema but translations should be in \\`strings.json\\`\n- Missing translations result in raw service names displayed in automations UI\n\n## Current Services (11 total)\n1. \\`set_blocked_services\\` - Set global blocked services with optional schedule\n2. \\`add_filter_url\\` - Add filter list URL\n3. \\`remove_filter_url\\` - Remove filter list URL  \n4. \\`refresh_filters\\` - Force refresh all filter lists\n5. \\`set_client_blocked_services\\` - Set per-client blocked services\n6. \\`add_dns_rewrite\\` - Add DNS rewrite rule\n7. \\`remove_dns_rewrite\\` - Remove DNS rewrite rule\n8. \\`check_host\\` - Check how domain would be filtered\n9. \\`get_query_log\\` - Retrieve paginated query log\n10. \\`clear_query_log\\` - Clear all query log entries\n11. \\`reset_stats\\` - Reset statistics counters\n\n## Implementation\nAdd to \\`strings.json\\`:\n\\`\\`\\`json\n{\n  \"services\": {\n    \"set_blocked_services\": {\n      \"name\": \"Set Blocked Services\",\n      \"description\": \"Set the list of services to block globally...\",\n      \"fields\": {\n        \"services\": {\n          \"name\": \"Services\",\n          \"description\": \"List of service IDs to block\"\n        },\n        \"schedule\": {\n          \"name\": \"Schedule\", \n          \"description\": \"Optional time-based schedule (v0.107.56+)\"\n        },\n        \"entry_id\": {\n          \"name\": \"Entry ID\",\n          \"description\": \"Config entry ID for multi-instance\"\n        }\n      }\n    }\n    // ../.. remaining 10 services\n  }\n}\n\\`\\`\\`\n\n## Files to Modify\n- \\`custom_components/adguard_home_extended/strings.json\\`\n- \\`custom_components/adguard_home_extended/translations/en.json\\` (copy of strings.json)\n\n## Acceptance Criteria\n- [ ] All 11 services have translations in strings.json\n- [ ] All service fields have name and description translations\n- [ ] translations/en.json mirrors strings.json services section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:10:12.906276-05:00","updated_at":"2025-12-17T21:16:30.35725-05:00","closed_at":"2025-12-17T21:16:30.35725-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-0c9","depends_on_id":"homeassistant_adguard_home-a43","type":"blocks","created_at":"2025-12-17T21:10:31.176139-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-0d8","title":"AdGuard Home Extended HACS Integration","description":"Build a comprehensive HACS integration for AdGuard Home with extended features beyond the core integration","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-17T15:52:08.727652-05:00","updated_at":"2025-12-17T16:26:27.861995-05:00","closed_at":"2025-12-17T16:26:27.861995-05:00"}
{"id":"homeassistant_adguard_home-0ln","title":"Add missing client management API tests","description":"## Gap Identified\nThe following client management methods in client.py lack unit tests:\n- \\`add_client()\\` - POST /control/clients/add\n- \\`update_client()\\` - POST /control/clients/update\n- \\`delete_client()\\` - POST /control/clients/delete\n\n## File Locations\n- **API Client**: \\`custom_components/adguard_home_extended/api/client.py\\`\n- **Test File**: \\`tests/test_api_client.py\\`\n- **Models**: \\`custom_components/adguard_home_extended/api/models.py\\` (AdGuardHomeClient dataclass)\n- **Existing test pattern**: See \\`test_get_clients_success\\` in test_api_client.py\n\n## OpenAPI Reference\n\\`\\`\\`yaml\n/control/clients/add:\n  post:\n    summary: Add a new client\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/Client'\n\n/control/clients/update:\n  post:\n    summary: Update client information\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/ClientUpdate'\n            \n/control/clients/delete:\n  post:\n    summary: Remove a client\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/ClientDelete'\n\\`\\`\\`\n\n## Test Cases Needed\n1. test_add_client_success\n2. test_add_client_duplicate_error\n3. test_add_client_with_all_options (tags, blocked_services, upstreams)\n4. test_update_client_success\n5. test_update_client_not_found\n6. test_delete_client_success\n7. test_delete_client_not_found\n\n## Acceptance Criteria\n- [ ] All CRUD operations for clients have tests\n- [ ] Tests verify request payload structure matches API expectations\n- [ ] Error cases handled (404, duplicate, validation)\n- [ ] Tests pass with \\`pytest tests/test_api_client.py -v\\`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:20:59.794785-05:00","updated_at":"2025-12-17T20:26:25.745013-05:00"}
{"id":"homeassistant_adguard_home-0lx","title":"Add blocked services schedule support","description":"## Background\nAdGuard Home v0.107.37+ changed the blocked services API format from a simple list to an object with schedule support:\n\n**Old format (pre-0.107.37):**\n\\`\\`\\`json\n[\"facebook\", \"youtube\", \"tiktok\"]\n\\`\\`\\`\n\n**New format (0.107.37+):**\n\\`\\`\\`json\n{\n  \"ids\": [\"facebook\", \"youtube\", \"tiktok\"],\n  \"schedule\": {\n    \"time_zone\": \"America/New_York\",\n    \"mon\": {\"start\": 0, \"end\": 86399999},\n    ../..\n  }\n}\n\\`\\`\\`\n\n## Current State\nThe integration correctly handles both formats for **reading** (client.py:274-284), but only supports the basic \\`ids\\` array for **writing**. Schedule functionality is not exposed.\n\n## Required Changes\n1. Add schedule parameters to \\`set_blocked_services()\\` method\n2. Create new service \\`set_blocked_services_schedule\\` \n3. Add sensors/attributes showing schedule status\n\n## Use Case\nUsers can schedule when services are blocked (e.g., block social media during work hours, allow after 6pm).\n\n## Research Source\nAdGuard Home Release Notes v0.107.37: 'Service blocking pause schedule - Users can now easily set pauses for the service blocking filter'","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T18:16:27.569473-05:00","updated_at":"2025-12-17T18:32:54.81617-05:00","closed_at":"2025-12-17T18:32:54.81617-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-0lx","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:17:52.341927-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-0xq","title":"Add api/client.py edge case tests","description":"## Coverage Gap\n\\`api/client.py\\` has 87% coverage (30 lines missing).\n\n## Missing Coverage\nLines 182-184, 237-238, 242-243, 293, 300, 332, 376-378, 382, 400, 421, 426-428, 451, 473-474, 478, 482, 563-564, 684, 729, 731, 754\n\n### Key Untested Areas\n- Error handling paths\n- Edge cases in API response parsing\n- Some rarely-used API method branches\n\n## Test Cases Needed\n1. test_request_error_handling\n2. test_parse_empty_response\n3. test_parse_malformed_response\n4. test_auth_failure_handling\n5. test_connection_error_retry\n\n## Files to Modify\n- \\`tests/test_api_client.py\\`\n\n## Acceptance Criteria\n- [ ] Error handling paths tested\n- [ ] Edge cases in response parsing covered\n- [ ] All public methods have test coverage","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T21:21:59.189283-05:00","updated_at":"2025-12-17T21:40:03.875583-05:00","closed_at":"2025-12-17T21:40:03.875583-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-0xq","depends_on_id":"homeassistant_adguard_home-x5q","type":"blocks","created_at":"2025-12-17T21:22:15.045889-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-1bb","title":"Project scaffolding and structure","description":"Create base project structure: custom_components/adguard_home_extended/, manifest.json, const.py, __init__.py","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T15:52:14.287541-05:00","updated_at":"2025-12-17T15:59:33.948677-05:00","closed_at":"2025-12-17T15:59:33.948677-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-1bb","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.604377-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-1ou","title":"Expose query log pagination in coordinator","description":"## Problem\nThe \\`get_query_log()\\` API method supports \\`offset\\` for pagination, but this isn't exposed through the coordinator for entities.\n\n## Current State\n- API client has: \\`get_query_log(limit, offset, search)\\`\n- Coordinator only configures \\`limit\\` via options\n- No way to paginate through historical queries\n\n## Impact\n- Limited to most recent N queries\n- Can't build sensors for historical analysis\n- Large query logs can't be efficiently traversed\n\n## Potential Solutions\n1. Add pagination support to the recent_queries sensor attributes\n2. Create a service to fetch specific query log pages\n3. Add configurable offset to options (less useful)\n\n## Recommendation\nImplement as a service call that returns paginated results rather than trying to fit into sensor model.\n\n## Files Affected\n- custom_components/adguard_home_extended/coordinator.py\n- custom_components/adguard_home_extended/__init__.py (services)\n- custom_components/adguard_home_extended/services.yaml","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T19:09:34.253736-05:00","updated_at":"2025-12-17T19:47:57.287837-05:00","closed_at":"2025-12-17T19:47:57.287837-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-1ou","depends_on_id":"homeassistant_adguard_home-h2a","type":"blocks","created_at":"2025-12-17T19:10:42.654243-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-1z3","title":"Complete service translations in strings.json","description":"## Problem\nThe services.yaml has full descriptions for all services, but strings.json is missing the service translations section. This affects HACS compliance and user experience.\n\n## Research\nPer Home Assistant developer docs for custom integrations:\n- Service descriptions should be in strings.json under a \"services\" key\n- This enables proper localization and consistent UI presentation\n- HACS checks for proper translation coverage\n\nCurrent services without translations:\n- set_blocked_services\n- add_filter_url\n- remove_filter_url\n- refresh_filters\n- set_client_blocked_services\n- add_dns_rewrite\n- remove_dns_rewrite\n\n## Fix Required\nAdd to strings.json:\n\\`\\`\\`json\n\"services\": {\n  \"set_blocked_services\": {\n    \"name\": \"Set Blocked Services\",\n    \"description\": \"Set the list of services to block globally in AdGuard Home.\",\n    \"fields\": {\n      \"services\": {\n        \"name\": \"Services\",\n        \"description\": \"List of service IDs to block\"\n      },\n      \"entry_id\": {\n        \"name\": \"Entry ID\",\n        \"description\": \"Config entry ID for multi-instance support\"\n      }\n    }\n  },\n  // ../.. other services\n}\n\\`\\`\\`\n\n## Files Affected\n- custom_components/adguard_home_extended/strings.json\n- custom_components/adguard_home_extended/translations/en.json","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T18:39:19.615926-05:00","updated_at":"2025-12-17T18:49:17.199518-05:00","closed_at":"2025-12-17T18:49:17.199518-05:00"}
{"id":"homeassistant_adguard_home-1zv","title":"Remove duplicate device_info property in coordinator","description":"## Problem\nThe \\`AdGuardHomeDataUpdateCoordinator\\` class defines the \\`device_info\\` property TWICE:\n- First definition: lines 68-83\n- Second definition: lines 153-167\n\nPython uses the last definition, making the first one dead code that causes confusion.\n\n## Research\n- This is likely a copy-paste error during development\n- The second definition is more complete (includes host in device name)\n- Dead code increases maintenance burden and confusion\n\n## Location\n- File: \\`custom_components/adguard_home_extended/coordinator.py\\` lines 68-83 (duplicate to remove)\n\n## Fix Required\nDelete the first \\`device_info\\` property definition (lines 68-83). Keep the second one at lines 153-167.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T16:35:18.028482-05:00","updated_at":"2025-12-17T16:43:55.919793-05:00","closed_at":"2025-12-17T16:43:55.919793-05:00"}
{"id":"homeassistant_adguard_home-23z","title":"Expand SafeSearch API support for per-engine control","description":"## Background\nIn AdGuard Home 0.107.x, SafeSearch became a complex object allowing per-search-engine control.\n\n## API Response Structure\n\\`\\`\\`json\n{\n  \"safesearch\": {\n    \"enabled\": true,\n    \"bing\": true,\n    \"duckduckgo\": true,\n    \"google\": true,\n    \"pixabay\": true,\n    \"yandex\": true,\n    \"youtube\": true\n  }\n}\n\\`\\`\\`\n\n## Current State\n- Reading: Correctly extracts \\`enabled\\` boolean from the object (models.py:26-35)\n- Writing: Only uses enable/disable endpoints, no per-engine control\n\n## Required Changes\n1. Add \\`SafeSearchSettings\\` model with all engine fields\n2. Add \\`GET/POST /control/safesearch/settings\\` API methods\n3. Create per-engine switches or a service to configure granular settings\n\n## Use Case\nUsers may want SafeSearch on Google/YouTube but not other engines.\n\n## Research Source\nAdGuard Home API shows safesearch is now an object with per-engine boolean fields, configurable via /control/safesearch/settings endpoint","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T18:17:43.000847-05:00","updated_at":"2025-12-17T18:34:38.982933-05:00","closed_at":"2025-12-17T18:34:38.982933-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-23z","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:18:02.036184-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-24l","title":"Diagnostics support","description":"Create diagnostics.py to provide troubleshooting data export with sensitive data redaction","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T15:53:28.217244-05:00","updated_at":"2025-12-17T16:26:16.896102-05:00","closed_at":"2025-12-17T16:26:16.896102-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-24l","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:39.168048-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-24l","depends_on_id":"homeassistant_adguard_home-5k9","type":"blocks","created_at":"2025-12-17T15:53:47.668627-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-2bj","title":"Add zip_release to HACS configuration","description":"## Rationale\nHACS supports \\`zip_release\\` option which enables downloading releases as zip files instead of cloning the repository. This can improve installation speed and reliability.\n\n### Current hacs.json\n\\`\\`\\`json\n{\n  \"name\": \"AdGuard Home Extended\",\n  \"homeassistant\": \"2025.1.0\",\n  \"render_readme\": true,\n  \"content_in_root\": false,\n  \"filename\": \"adguard_home_extended\",\n  \"country\": [\"ALL\"]\n}\n\\`\\`\\`\n\n### Proposed Addition\n\\`\\`\\`json\n{\n  \"zip_release\": true\n}\n\\`\\`\\`\n\n### Benefits\n- Faster downloads (single zip vs git clone)\n- Works better with GitHub rate limiting\n- Recommended for production HACS integrations\n\n### Prerequisites\n- Must have GitHub releases configured\n- Release assets should be properly tagged\n\n### References\n- HACS documentation: https://hacs.xyz/docs/publish/include","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-17T19:56:35.021023-05:00","updated_at":"2025-12-17T20:23:43.716047-05:00","closed_at":"2025-12-17T20:23:43.716047-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-2bj","depends_on_id":"homeassistant_adguard_home-mcg","type":"blocks","created_at":"2025-12-17T19:57:24.452291-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-3h5","title":"Review and enhance diagnostics output","description":"## Background\nThe integration includes a \\`diagnostics.py\\` file for providing debug information when users report issues. This should be reviewed to ensure it:\n1. Properly redacts sensitive information (passwords, tokens)\n2. Provides useful debugging context\n3. Follows Home Assistant diagnostics best practices\n\n## Research Findings (Dec 17, 2025)\nHome Assistant diagnostics should:\n- Redact passwords, API keys, and authentication tokens\n- Include coordinator data for state debugging  \n- Include config entry options and data (redacted)\n- Include device information\n- Optionally include entity states\n\n## Files to Review\n- \\`custom_components/adguard_home_extended/diagnostics.py\\`\n- Reference: Home Assistant core diagnostics patterns\n\n## Acceptance Criteria\n- [ ] Passwords and credentials are properly redacted\n- [ ] Diagnostic output includes:\n  - [ ] Config entry data (host, port, SSL settings - NOT password)\n  - [ ] Coordinator last update success/failure\n  - [ ] AdGuard Home version detected\n  - [ ] Number of entities (sensors, switches, etc.)\n  - [ ] Feature flags based on version detection\n- [ ] Test coverage for diagnostics redaction","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T21:10:21.987903-05:00","updated_at":"2025-12-17T21:18:25.733683-05:00","closed_at":"2025-12-17T21:18:25.733683-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-3h5","depends_on_id":"homeassistant_adguard_home-a43","type":"blocks","created_at":"2025-12-17T21:10:31.232184-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-3pm","title":"Fix query log search parameter not being used in URL","description":"## Problem\nIn \\`client.py:304-312\\`, the \\`search\\` parameter is accepted but never actually added to the request URL.\n\n## Current Code\n\\`\\`\\`python\nasync def get_query_log(\n    self,\n    limit: int = 100,\n    offset: int = 0,\n    search: str | None = None,\n) -\u003e list[dict]:\n    params = {\"limit\": limit, \"offset\": offset}\n    if search:\n        params[\"search\"] = search  # \u003c-- params dict created but not used\n    data = await self._get(f\"{API_QUERYLOG}?limit={limit}\u0026offset={offset}\")  # \u003c-- search missing\n    return data.get(\"data\", []) if data else []\n\\`\\`\\`\n\n## Required Fix\n\\`\\`\\`python\nasync def get_query_log(\n    self,\n    limit: int = 100,\n    offset: int = 0,\n    search: str | None = None,\n) -\u003e list[dict]:\n    url = f\"{API_QUERYLOG}?limit={limit}\u0026offset={offset}\"\n    if search:\n        url += f\"\u0026search={search}\"\n    data = await self._get(url)\n    return data.get(\"data\", []) if data else []\n\\`\\`\\`\n\n## Impact\nUsers cannot filter query log results by search term even though the parameter exists in the function signature.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-17T18:15:57.899763-05:00","updated_at":"2025-12-17T18:22:46.440827-05:00","closed_at":"2025-12-17T18:22:46.440827-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-3pm","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:17:52.230663-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-3q9","title":"Enhance hacs.json with recommended fields","description":"## Problem\nThe \\`hacs.json\\` file only contains minimal required fields. Adding optional fields improves HACS integration and user experience.\n\n## Research\nPer HACS documentation, recommended optional fields:\n- \\`render_readme\\`: true - Shows README in HACS UI\n- \\`country\\`: Array of country codes if region-specific\n- \\`hacs\\`: Minimum HACS version required\n\n## Current Content\n\\`\\`\\`json\n{\n  'name': 'AdGuard Home Extended',\n  'homeassistant': '2024.1.0'\n}\n\\`\\`\\`\n\n## Location\n- File: \\`hacs.json\\`\n\n## Fix Required\n\\`\\`\\`json\n{\n  'name': 'AdGuard Home Extended',\n  'homeassistant': '2024.1.0',\n  'render_readme': true\n}\n\\`\\`\\`","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T16:36:29.021357-05:00","updated_at":"2025-12-17T16:51:08.715884-05:00","closed_at":"2025-12-17T16:51:08.715884-05:00"}
{"id":"homeassistant_adguard_home-3sm","title":"Track AdGuard Home v0.108.0 beta for future API changes","description":"## Context\nAdGuard Home v0.108.0 is in beta (v0.108.0-b.75 as of Sept 2025). This release may introduce breaking API changes or new features.\n\n## Known v0.108.0 Changes (from beta changelog)\n- Schema version changes (13 -\u003e 14)\n- clients object structure changed from array to object with persistent/runtime_sources\n- Potential new authentication redesign in progress\n\n## Monitoring Required\n1. Watch AdGuard Home releases for v0.108.0 stable\n2. Review CHANGELOG.md for API breaking changes\n3. Test integration against v0.108.0 when released\n4. Update models and API client as needed\n\n## Research Source\n- Perplexity search Dec 17, 2025\n- AdGuard Home GitHub releases page\n- v0.108.0 beta release notes\n\n## Impact\n- Backlog priority - no immediate action required\n- Proactive tracking to avoid surprises when v0.108.0 goes stable","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-17T20:41:09.175962-05:00","updated_at":"2025-12-17T21:00:52.343868-05:00","closed_at":"2025-12-17T21:00:52.343868-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-3sm","depends_on_id":"homeassistant_adguard_home-lyi","type":"blocks","created_at":"2025-12-17T20:41:20.19592-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-47a","title":"Add missing blocked services API tests","description":"## Gap Identified\nThe following blocked services methods in client.py lack unit tests:\n- \\`get_blocked_services_all()\\` - GET /control/blocked_services/all\n- \\`set_blocked_services()\\` - POST /control/blocked_services/set\n\n## File Locations\n- **API Client**: \\`custom_components/adguard_home_extended/api/client.py\\`\n- **Test File**: \\`tests/test_api_client.py\\`\n- **Models**: \\`custom_components/adguard_home_extended/api/models.py\\`\n- **Existing test pattern**: See \\`test_get_status_success\\`, \\`test_get_stats_success\\` in test_api_client.py for mocking pattern\n\n## OpenAPI Reference\n\\`\\`\\`yaml\n/control/blocked_services/all:\n  get:\n    summary: Get available services to block\n    responses:\n      200:\n        content:\n          application/json:\n            schema:\n              \\ref: '#/components/schemas/BlockedServicesAll'\n\n/control/blocked_services/set:\n  post:\n    summary: Set blocked services list\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/BlockedServicesArray'\n\\`\\`\\`\n\n## Test Cases Needed\n1. test_get_blocked_services_all_success\n2. test_get_blocked_services_all_empty\n3. test_set_blocked_services_success\n4. test_set_blocked_services_empty_list\n5. test_set_blocked_services_invalid_service\n\n## Acceptance Criteria\n- [ ] All methods have corresponding unit tests\n- [ ] Tests use mocked aiohttp sessions (see conftest.py fixtures)\n- [ ] Edge cases covered (empty lists, invalid data)\n- [ ] Tests pass with \\`pytest tests/test_api_client.py -v\\`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:20:51.543201-05:00","updated_at":"2025-12-17T20:26:16.621826-05:00"}
{"id":"homeassistant_adguard_home-4bc","title":"Add service descriptions to translations","description":"## Problem\nService descriptions in \\`services.yaml\\` are in English only. For proper localization support, service names and descriptions should also be in \\`strings.json\\` and translation files.\n\n## Research\n- Home Assistant supports translated service names/descriptions\n- Format in strings.json:\n\\`\\`\\`json\n{\n  'services': {\n    'set_blocked_services': {\n      'name': 'Set Blocked Services',\n      'description': 'Set the list of services to block globally',\n      'fields': {\n        'services': {\n          'name': 'Services',\n          'description': 'List of service IDs to block'\n        }\n      }\n    }\n  }\n}\n\\`\\`\\`\n\n## Location\n- File: \\`custom_components/adguard_home_extended/strings.json\\`\n- File: \\`custom_components/adguard_home_extended/translations/en.json\\`\n\n## Fix Required\nAdd \\`services\\` section to strings.json with all service definitions from services.yaml","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T16:36:43.627537-05:00","updated_at":"2025-12-17T16:52:16.54959-05:00","closed_at":"2025-12-17T16:52:16.54959-05:00"}
{"id":"homeassistant_adguard_home-4c6","title":"API Test Coverage \u0026 OpenAPI Compliance","description":"Comprehensive effort to align the AdGuard Home Extended integration with the official OpenAPI 3.0.3 specification and achieve full test coverage.\n\n## Background\nAn audit of existing tests against the AdGuard Home OpenAPI spec (https://github.com/AdguardTeam/AdGuardHome/blob/master/openapi/openapi.yaml) revealed significant gaps in both test coverage and model accuracy.\n\n## Key Findings\n- ~15 API client methods lack unit tests (33% gap)\n- ~20+ model fields missing vs OpenAPI schema\n- Several endpoint categories not implemented (TLS, access control, etc.)\n\n## Goals\n1. Achieve 100% test coverage for existing API client methods\n2. Update data models to match OpenAPI schema\n3. Implement missing endpoints where valuable for HA integration\n4. Establish contract testing patterns for future development\n\n## Reference\n- OpenAPI Spec: ~3,251 lines defining all endpoints\n- Current client.py: ~768 lines, ~45 methods\n- Current test coverage: ~56 test methods for ~30 methods","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-17T20:20:43.564848-05:00","updated_at":"2025-12-17T20:20:43.564848-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-47a","type":"blocks","created_at":"2025-12-17T20:24:20.420663-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-0ln","type":"blocks","created_at":"2025-12-17T20:24:20.462394-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-810","type":"blocks","created_at":"2025-12-17T20:24:20.498701-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-tsi","type":"blocks","created_at":"2025-12-17T20:24:20.538872-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-e0q","type":"blocks","created_at":"2025-12-17T20:24:20.573577-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-elu","type":"blocks","created_at":"2025-12-17T20:24:25.340988-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-iwx","type":"blocks","created_at":"2025-12-17T20:24:25.387842-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-wa7","type":"blocks","created_at":"2025-12-17T20:24:25.434604-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-yij","type":"blocks","created_at":"2025-12-17T20:24:25.478307-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-rjb","type":"blocks","created_at":"2025-12-17T20:24:25.525133-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-b2b","type":"blocks","created_at":"2025-12-17T20:24:30.795547-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-8qg","type":"blocks","created_at":"2025-12-17T20:24:30.831238-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-ufp","type":"blocks","created_at":"2025-12-17T20:24:30.876559-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-v5q","type":"blocks","created_at":"2025-12-17T20:24:30.914674-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-y7f","type":"blocks","created_at":"2025-12-17T20:24:30.950345-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4c6","depends_on_id":"homeassistant_adguard_home-xv3","type":"blocks","created_at":"2025-12-17T20:24:30.985373-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-4jy","title":"Filter list management services","description":"Create HA services for: add_filter_url, remove_filter_url, enable_filter, disable_filter, refresh_filters","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:52:55.786514-05:00","updated_at":"2025-12-17T16:02:25.564901-05:00","closed_at":"2025-12-17T16:02:25.564901-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-4jy","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.905499-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4jy","depends_on_id":"homeassistant_adguard_home-5k9","type":"blocks","created_at":"2025-12-17T15:53:47.521052-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-4sw","title":"Submit integration to home-assistant/brands repository","description":"## Problem\nFor full UI integration with proper icons in Home Assistant, custom integrations should submit their brand assets to the home-assistant/brands repository.\n\n## Required Assets\nSubmit to \\`home-assistant/brands\\` repo under \\`custom_integrations/adguard_home_extended/\\`:\n- \\`icon.png\\` - 256x256 icon\n- \\`icon@2x.png\\` - 512x512 icon (retina)\n- \\`logo.png\\` - Brand logo\n\n## Benefits\n1. Integration shows proper icon in HA UI\n2. Consistent branding across Home Assistant\n3. Professional appearance in device/integration lists\n\n## HACS Documentation\nFrom HACS publish requirements: 'You must have added your integration to home-assistant/brands to conform to the UI standards in Home Assistant.'\n\n## Research Source\n- HACS documentation: https://hacs.xyz/docs/publish/integration/\n- Perplexity search Dec 17, 2025 - HACS integration requirements\n\n## Implementation Steps\n1. Create brand assets (can use AdGuard official logo with permission)\n2. Fork home-assistant/brands\n3. Add \\`custom_integrations/adguard_home_extended/\\` directory\n4. Submit PR with icon.png, icon@2x.png, logo.png\n5. Update README once merged\n\n## Impact\n- Medium priority - integration works without it but looks unprofessional\n- Required for full HACS compliance","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:40:17.945628-05:00","updated_at":"2025-12-17T20:56:12.488222-05:00","closed_at":"2025-12-17T20:56:12.488222-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-4sw","depends_on_id":"homeassistant_adguard_home-lyi","type":"blocks","created_at":"2025-12-17T20:41:19.977705-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-4to","title":"Unregister services on integration unload","description":"## Problem\nThe \\`async_unload_entry\\` function does not unregister services when the integration is removed. If the user removes the last AdGuard Home config entry, stale services remain in Home Assistant and will cause errors when called.\n\n## Research\n- Home Assistant best practice: clean up services when last entry is unloaded\n- Stale services show in Developer Tools but fail with cryptic errors\n- Other well-maintained integrations handle this cleanup\n\n## Location\n- File: \\`custom_components/adguard_home_extended/__init__.py\\` lines 247-252\n\n## Fix Required\nAdd service cleanup when the last entry is unloaded:\n\\`\\`\\`python\nasync def async_unload_entry(hass: HomeAssistant, entry: ConfigEntry) -\u003e bool:\n    if unload_ok := await hass.config_entries.async_unload_platforms(entry, PLATFORMS):\n        hass.data[DOMAIN].pop(entry.entry_id)\n        \n        # Remove services if this was the last entry\n        if not hass.data[DOMAIN]:\n            for service in [SERVICE_SET_BLOCKED_SERVICES, SERVICE_ADD_FILTER_URL, ../..]:\n                hass.services.async_remove(DOMAIN, service)\n    return unload_ok\n\\`\\`\\`\n\n## Dependencies\nShould be addressed alongside homeassistant_adguard_home-xdm (multi-instance fix) for consistency.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T16:35:27.178258-05:00","updated_at":"2025-12-17T16:47:05.672347-05:00","closed_at":"2025-12-17T16:47:05.672347-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-4to","depends_on_id":"homeassistant_adguard_home-xdm","type":"blocks","created_at":"2025-12-17T16:35:31.136591-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-4ul","title":"AdGuard Home API client library","description":"Create async API client for AdGuard Home REST API with Basic Auth, covering: status, stats, protection toggles, filtering, clients, blocked services, DHCP","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-17T15:52:23.892843-05:00","updated_at":"2025-12-17T16:00:21.3243-05:00","closed_at":"2025-12-17T16:00:21.3243-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-4ul","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.640196-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-4ul","depends_on_id":"homeassistant_adguard_home-1bb","type":"blocks","created_at":"2025-12-17T15:53:47.237342-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-53z","title":"Integration Audit - API \u0026 HA Compatibility","description":"Complete audit of AdGuard Home Extended integration for compatibility with:\n- AdGuard Home v0.107.69 (latest stable Dec 2025)\n- Home Assistant 2024.12.x / 2025.1.0+\n\nThis epic tracks all identified issues from the comprehensive audit including API compatibility, Home Assistant integration patterns, and code quality improvements.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-17T18:15:40.386438-05:00","updated_at":"2025-12-17T19:28:34.26952-05:00","closed_at":"2025-12-17T19:28:34.26952-05:00"}
{"id":"homeassistant_adguard_home-59w","title":"Add client_entities.py toggle tests","description":"## Coverage Gap\n\\`client_entities.py\\` has 81% coverage (30 lines missing).\n\n## Missing Coverage\nLines 96, 124, 136, 192, 225, 230, 234, 251, 256-259, 263, 267, 284, 289-292, 296, 300, 324, 329, 352, 357-360, 364, 368\n\n### Key Untested Areas\n- \\`AdGuardClientFilteringSwitch.async_turn_on()\\`\n- \\`AdGuardClientFilteringSwitch.async_turn_off()\\`\n- \\`AdGuardClientParentalSwitch\\` toggle methods\n- \\`AdGuardClientSafeBrowsingSwitch\\` toggle methods  \n- \\`AdGuardClientSafeSearchSwitch\\` toggle methods\n- Client entity update on coordinator refresh\n\n## Test Cases Needed\n1. test_client_filtering_switch_turn_on\n2. test_client_filtering_switch_turn_off\n3. test_client_parental_switch_toggle\n4. test_client_safebrowsing_switch_toggle\n5. test_client_safesearch_switch_toggle\n6. test_client_entity_coordinator_update\n\n## Files to Modify\n- \\`tests/test_client_entities.py\\`\n\n## Acceptance Criteria\n- [ ] All client switch toggle methods tested\n- [ ] API call verification for each toggle\n- [ ] State update after toggle verified","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:21:51.333936-05:00","updated_at":"2025-12-17T21:37:10.462294-05:00","closed_at":"2025-12-17T21:37:10.462294-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-59w","depends_on_id":"homeassistant_adguard_home-x5q","type":"blocks","created_at":"2025-12-17T21:22:14.996549-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-5g2","title":"Add EntityCategory.DIAGNOSTIC to appropriate sensors","description":"## Problem\nSensors that provide diagnostic/debug information should be marked with \\`entity_category=EntityCategory.DIAGNOSTIC\\`. This helps Home Assistant organize them in the UI under 'Diagnostic' rather than cluttering the main entity list.\n\n## Research\n- Home Assistant UI groups entities by category\n- Diagnostic entities are hidden by default in some views\n- Improves UX by separating primary entities from debug/stats info\n\n## Affected Sensors\n- \\`avg_processing_time\\` - Processing time is diagnostic\n- \\`recent_queries\\` - Query log is diagnostic\n- \\`dns_rewrites_count\\` - Rewrite count is diagnostic\n- \\`dhcp_leases_count\\` - Lease count is diagnostic\n- \\`dhcp_static_leases_count\\` - Static lease count is diagnostic\n\n## Location\n- File: \\`custom_components/adguard_home_extended/sensor.py\\`\n\n## Fix Required\nAdd to sensor descriptions:\n\\`\\`\\`python\nfrom homeassistant.helpers.entity import EntityCategory\n\nAdGuardHomeSensorEntityDescription(\n    key='avg_processing_time',\n    entity_category=EntityCategory.DIAGNOSTIC,\n    # ../..\n),\n\\`\\`\\`","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T16:36:18.957526-05:00","updated_at":"2025-12-17T16:50:49.136794-05:00","closed_at":"2025-12-17T16:50:49.136794-05:00"}
{"id":"homeassistant_adguard_home-5gv","title":"Add missing fields to AdGuardHomeStatus model","description":"## Problem\nThe \\`AdGuardHomeStatus\\` dataclass in \\`api/models.py\\` is missing critical fields that the AdGuard Home API returns:\n- \\`safebrowsing_enabled\\` (boolean)\n- \\`parental_enabled\\` (boolean)\n- \\`safesearch\\` (object with \\`enabled\\` field)\n\n## Research\nPer AdGuard Home's OpenAPI spec and REST API documentation:\n- The \\`/control/status\\` endpoint returns these fields in every response\n- These are needed to correctly display switch states in Home Assistant\n- The official HA core integration reads these fields\n\n## Location\n- File: \\`custom_components/adguard_home_extended/api/models.py\\` lines 11-30\n\n## Fix Required\nUpdate \\`AdGuardHomeStatus\\` dataclass and \\`from_dict\\` method to include:\n\\`\\`\\`python\nsafebrowsing_enabled: bool = False\nparental_enabled: bool = False\nsafesearch_enabled: bool = False\n\\`\\`\\`\n\nHandle \\`safesearch\\` as nested object: \\`data.get('safesearch', {}).get('enabled', False)\\`","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T16:34:36.894808-05:00","updated_at":"2025-12-17T16:39:49.4484-05:00","closed_at":"2025-12-17T16:39:49.4484-05:00"}
{"id":"homeassistant_adguard_home-5ij","title":"Document HA 2025.12 and AGH v0.107.69 compatibility verification","description":"## Summary\nAudit confirms integration is compatible with latest releases as of December 17, 2025.\n\n## Verified Compatibility\n\n### Home Assistant 2025.12 (Released Dec 3, 2025)\nKey features verified:\n- ✅ DataUpdateCoordinator with explicit config_entry (2025.11 deprecation ready)\n- ✅ CoordinatorEntity base class usage\n- ✅ translation_key pattern for entity names\n- ✅ Options flow with update listener\n- ✅ Proper unique_id and device_info\n\n### AdGuard Home v0.107.69 (Released Oct 30, 2025)\nAPI endpoints verified:\n- ✅ All core protection APIs current\n- ✅ Blocked services with schedules (v0.107.56+)\n- ✅ DNS rewrite enable/disable (v0.107.68+)\n- ✅ Query log response_status filter (v0.107.68+)\n- ⚠️ SafeSearch enable/disable deprecated (but functional)\n\n## Research Source\n- Perplexity searches Dec 17, 2025\n- Home Assistant release notes 2025.12\n- AdGuard Home GitHub releases\n- AdGuard Home OpenAPI specification\n\n## Action Items\nUpdate README compatibility matrix if not already current.\n\n## Impact\n- Documentation task - no code changes required\n- Builds confidence for users on latest versions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:41:00.047835-05:00","updated_at":"2025-12-17T20:56:44.900077-05:00","closed_at":"2025-12-17T20:56:44.900077-05:00"}
{"id":"homeassistant_adguard_home-5ji","title":"Test integration against Home Assistant 2025.12","description":"## Rationale\nHome Assistant 2025.12 was released with several breaking changes and new features that need verification:\n\n### Breaking Changes to Verify\n- Core and Supervised installation methods removed (not applicable but verify docs)\n- \\`async_config_entry_first_refresh\\` now requires config_entry in some contexts\n- Template \\`issues\\` function only returns active issues\n- Various deprecated constants removed from lock, media_player, camera, vacuum integrations\n\n### New Features to Consider\n- **Home Assistant Labs**: New experimental features system\n- **Intuitive triggers/conditions**: New automation system targeting domains\n- **Default dashboard settings**: Now system-wide\n- **Energy dashboard**: Real-time power monitoring\n\n### Testing Required\n1. Fresh installation on HA 2025.12\n2. Upgrade from HA 2025.1 to 2025.12 with integration installed\n3. Verify all entities load correctly\n4. Verify all services work\n5. Verify config flow and options flow\n6. Check for deprecation warnings in logs\n\n### Source\nPerplexity research confirmed HA 2025.12 released Dec 2025 with these changes.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T19:55:43.400425-05:00","updated_at":"2025-12-17T20:22:34.710571-05:00","closed_at":"2025-12-17T20:22:34.710571-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-5ji","depends_on_id":"homeassistant_adguard_home-mcg","type":"blocks","created_at":"2025-12-17T19:57:18.74978-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-5k9","title":"DataUpdateCoordinator implementation","description":"Create coordinator.py with DataUpdateCoordinator for polling AdGuard Home API. Handle connection errors gracefully with UpdateFailed","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-17T15:52:33.085114-05:00","updated_at":"2025-12-17T16:00:25.234761-05:00","closed_at":"2025-12-17T16:00:25.234761-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-5k9","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.716867-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-5k9","depends_on_id":"homeassistant_adguard_home-4ul","type":"blocks","created_at":"2025-12-17T15:53:47.315338-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-5xf","title":"Fix switch state reading for safe_browsing, parental_control, safe_search","description":"## Problem\nThe Safe Browsing, Parental Control, and Safe Search switches all incorrectly use \\`data.status.protection_enabled\\` for their \\`is_on_fn\\` lambda. This means they show the wrong state in the Home Assistant UI.\n\n## Research\n- AdGuard Home API \\`/control/status\\` returns individual boolean fields for each feature\n- The official HA core AdGuard integration correctly reads these separate states\n- Comments in code say 'Will be updated when we can read safebrowsing state' - but the API DOES support this\n\n## Location\n- File: \\`custom_components/adguard_home_extended/switch.py\\` lines 46-66\n\n## Fix Required\nUpdate each switch description's \\`is_on_fn\\`:\n\\`\\`\\`python\n# safe_browsing\nis_on_fn=lambda data: data.status.safebrowsing_enabled if data.status else None\n\n# parental_control  \nis_on_fn=lambda data: data.status.parental_enabled if data.status else None\n\n# safe_search\nis_on_fn=lambda data: data.status.safesearch_enabled if data.status else None\n\\`\\`\\`\n\n## Dependencies\nRequires homeassistant_adguard_home-5gv (AdGuardHomeStatus model fields) to be completed first.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T16:34:46.06856-05:00","updated_at":"2025-12-17T16:40:48.770928-05:00","closed_at":"2025-12-17T16:40:48.770928-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-5xf","depends_on_id":"homeassistant_adguard_home-5gv","type":"blocks","created_at":"2025-12-17T16:34:50.689615-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-619","title":"Add switch.py entity action tests","description":"## Coverage Gap\n\\`switch.py\\` has 67% coverage (57 lines missing).\n\n## Missing Coverage\nLines 131-166, 271-274, 279, 283-284, 288-289, 310-313, 318-321, 329, 333-356, 360-362, 415, 435, 448, 461\n\n### Key Untested Areas\n- \\`AdGuardHomeSwitch.async_turn_on()\\` - Protection toggle\n- \\`AdGuardHomeSwitch.async_turn_off()\\` - Protection toggle\n- \\`AdGuardDnsRewriteSwitch.async_turn_on()\\` - DNS rewrite toggle\n- \\`AdGuardDnsRewriteSwitch.async_turn_off()\\` - DNS rewrite toggle\n- \\`AdGuardBlockedServiceSwitch.async_turn_on()\\` - Service blocking\n- \\`AdGuardBlockedServiceSwitch.async_turn_off()\\` - Service blocking\n\n## Test Cases Needed\n1. test_protection_switch_turn_on\n2. test_protection_switch_turn_off\n3. test_filtering_switch_turn_on\n4. test_filtering_switch_turn_off\n5. test_safe_browsing_switch_toggle\n6. test_parental_control_switch_toggle\n7. test_safe_search_switch_toggle\n8. test_dns_rewrite_switch_turn_on\n9. test_dns_rewrite_switch_turn_off\n10. test_blocked_service_switch_turn_on\n11. test_blocked_service_switch_turn_off\n12. test_switch_coordinator_refresh_after_toggle\n\n## Files to Modify\n- \\`tests/test_switch.py\\`\n\n## Acceptance Criteria\n- [ ] All switch async_turn_on/off methods tested\n- [ ] Coordinator refresh after toggle verified\n- [ ] Error handling tested","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T21:21:29.014748-05:00","updated_at":"2025-12-17T21:30:04.525891-05:00","closed_at":"2025-12-17T21:30:04.525891-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-619","depends_on_id":"homeassistant_adguard_home-x5q","type":"blocks","created_at":"2025-12-17T21:22:14.851419-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-63z","title":"Add version-gated feature detection for newer APIs","description":"## Problem\nThe integration has excellent version parsing (version.py) but doesn't extensively use it to gate API feature usage. This could cause issues with older AdGuard Home installations.\n\n## Current Version Support\n\\`\\`\\`\n- v0.100+: Base API (status, filtering, protection, clients)\n- v0.107.30+: Stats and query log configuration APIs\n- v0.107.52+: Ecosia safe search engine support\n- v0.107.56+: Blocked services with schedules, client search API\n- v0.107.58+: Check host with client and qtype parameters\n- v0.107.65+: New blocked services (ChatGPT, Claude, DeepSeek)\n- v0.107.68+: Query log response_status filter, DNS rewrite enabled field\n\\`\\`\\`\n\n## Recommended Implementation\n\\`\\`\\`python\n# In coordinator or entity code:\nif self.data.version \u003e= (0, 107, 68):\n    # Use rewrite enabled field\n    await self.client.set_rewrite_enabled(domain, answer, enabled)\nelse:\n    # Fall back to delete/re-add\n    await self.client.delete_rewrite(domain, answer)\n    await self.client.add_rewrite(domain, answer)\n\\`\\`\\`\n\n## Research Source\n- Perplexity search Dec 17, 2025 - AdGuard Home API changelog\n- version.py already has comparison operators implemented\n\n## Impact\n- Low priority - most users run recent AGH versions\n- Improves robustness for users with older installations\n- AdGuardHomeVersion class already supports \u003e= comparisons","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T20:40:30.86544-05:00","updated_at":"2025-12-17T21:00:04.474498-05:00","closed_at":"2025-12-17T21:00:04.474498-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-63z","depends_on_id":"homeassistant_adguard_home-6iy","type":"blocks","created_at":"2025-12-17T20:41:29.768597-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-66o","title":"Add newer AdGuard Home API endpoints","description":"## Problem\nSeveral newer AdGuard Home API endpoints (v0.107.30+) are not implemented in the API client. These enable additional functionality for stats and query log configuration.\n\n## Research\nFrom AdGuard Home API CHANGELOG.md:\n\n### v0.107.30 - Stats Config APIs\n- \\`GET /control/stats/config\\` - Get stats configuration\n- \\`PUT /control/stats/config/update\\` - Update stats config\n  Format: {\"enabled\": true, \"interval\": 3600, \"ignored\": [\"example.com\"]}\n\n### v0.107.30 - Query Log Config APIs\n- \\`GET /control/querylog/config\\` - Get query log configuration\n- \\`PUT /control/querylog/config/update\\` - Update query log config\n  Format: {\"enabled\": true, \"anonymize_client_ip\": false, \"interval\": 3600, \"ignored\": [\"example.com\"]}\n\n### v0.107.56 - Client Search API\n- \\`POST /control/clients/search\\` - Search clients (replaces deprecated GET /control/clients/find)\n  Format: {\"clients\": [{\"id\": \"192.0.2.1\"}, {\"id\": \"test\"}]}\n\n### v0.107.56 - Blocked Services with Schedule\n- \\`GET /control/blocked_services/get\\` - Get blocked services with schedule\n- \\`PUT /control/blocked_services/update\\` - Update blocked services with schedule\n\n## Fix Required\nAdd API endpoints to const.py:\n\\`\\`\\`python\nAPI_STATS_CONFIG: Final = \"/control/stats/config\"\nAPI_STATS_CONFIG_UPDATE: Final = \"/control/stats/config/update\"\nAPI_QUERYLOG_CONFIG: Final = \"/control/querylog/config\"\nAPI_QUERYLOG_CONFIG_UPDATE: Final = \"/control/querylog/config/update\"\nAPI_CLIENTS_SEARCH: Final = \"/control/clients/search\"\nAPI_BLOCKED_SERVICES_GET: Final = \"/control/blocked_services/get\"\nAPI_BLOCKED_SERVICES_UPDATE: Final = \"/control/blocked_services/update\"\n\\`\\`\\`\n\nAdd corresponding methods to api/client.py.\n\n## Files Affected\n- custom_components/adguard_home_extended/const.py\n- custom_components/adguard_home_extended/api/client.py","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T18:39:42.594132-05:00","updated_at":"2025-12-17T18:57:41.150267-05:00","closed_at":"2025-12-17T18:57:41.150267-05:00"}
{"id":"homeassistant_adguard_home-6d8","title":"Migrate SafeSearch to non-deprecated settings API","description":"## Problem\nThe AdGuard Home OpenAPI spec marks these endpoints as **deprecated**:\n- \\`POST /control/safesearch/enable\\`\n- \\`POST /control/safesearch/disable\\`\n\n## Current Implementation (api/client.py)\n\\`\\`\\`python\nasync def set_safesearch(self, enabled: bool) -\u003e None:\n    endpoint = API_SAFESEARCH_ENABLE if enabled else API_SAFESEARCH_DISABLE\n    await self._post(endpoint)\n\\`\\`\\`\n\n## Recommended Fix\nUse \\`PUT /control/safesearch/settings\\` instead, which is the current supported API:\n\\`\\`\\`python\nasync def set_safesearch(self, enabled: bool) -\u003e None:\n    settings = await self.get_safesearch_settings()\n    settings.enabled = enabled\n    await self.set_safesearch_settings(settings)\n\\`\\`\\`\n\n## Research Source\nPerplexity search on Dec 17, 2025 - AdGuard Home OpenAPI specification shows deprecated flag on enable/disable endpoints.\n\n## Impact\n- Medium priority - endpoints still work but may be removed in future AGH versions\n- Already have \\`get_safesearch_settings()\\` and \\`set_safesearch_settings()\\` implemented","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T20:39:44.023146-05:00","updated_at":"2025-12-17T20:45:23.79859-05:00","closed_at":"2025-12-17T20:45:23.79859-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-6d8","depends_on_id":"homeassistant_adguard_home-lyi","type":"blocks","created_at":"2025-12-17T20:41:14.243003-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-6iy","title":"Add _async_setup method to DataUpdateCoordinator","description":"## Problem\nSince Home Assistant 2024.8, DataUpdateCoordinator supports \\`_async_setup()\\` method for one-time initialization logic that runs during the first refresh.\n\n## Benefits\n1. Separates one-time setup from repeated data fetching\n2. Same error handling as \\`_async_update_data\\` (ConfigEntryError, ConfigEntryAuthFailed)\n3. Cleaner code organization\n\n## Current State\ncoordinator.py does not override \\`_async_setup()\\`. All initialization happens in \\`_async_update_data()\\`.\n\n## Recommended Implementation\n\\`\\`\\`python\nasync def _async_setup(self) -\u003e None:\n    \"\"\"Set up the coordinator - called once during first refresh.\"\"\"\n    # Could move version detection or capability checks here\n    # Example: Detect AGH version and available features\n    status = await self.client.get_status()\n    self._version = parse_version(status.version)\n    \n    # Pre-fetch available blocked services (rarely changes)\n    self._available_services = await self.client.get_all_blocked_services()\n\\`\\`\\`\n\n## Research Source\n- Home Assistant Developer Blog: 'Set up your DataUpdateCoordinator with a setup method' (Aug 5, 2024)\n- GitHub Architecture Discussion #1073\n\n## Impact\n- Low-medium priority - works without it but improves code organization\n- Could optimize by moving rarely-changing data to setup phase","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:40:07.085008-05:00","updated_at":"2025-12-17T20:54:37.098932-05:00","closed_at":"2025-12-17T20:54:37.098932-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-6iy","depends_on_id":"homeassistant_adguard_home-dtv","type":"blocks","created_at":"2025-12-17T20:41:25.285405-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-6tu","title":"Sensor entities","description":"Create sensor.py with sensors for: DNS queries total, blocked queries, avg processing time, top blocked domains, top clients","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:52:37.859852-05:00","updated_at":"2025-12-17T16:00:31.794061-05:00","closed_at":"2025-12-17T16:00:31.794061-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-6tu","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.753872-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-6tu","depends_on_id":"homeassistant_adguard_home-5k9","type":"blocks","created_at":"2025-12-17T15:53:47.354374-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-6zp","title":"Unit tests","description":"Create comprehensive pytest tests: API client tests, config flow tests, coordinator tests, entity tests. Use pytest-homeassistant-custom-component","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:53:18.666441-05:00","updated_at":"2025-12-17T16:10:44.571359-05:00","closed_at":"2025-12-17T16:10:44.571359-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-6zp","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:39.093287-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-70o","title":"Add async_remove_entry handler","description":"## Problem\nThe integration is missing the \\`async_remove_entry\\` handler for clean device registry removal.\n\n## Research\nPer Home Assistant developer docs:\n- \\`async_remove_entry\\` is called when a config entry is removed\n- This is the place to clean up any persistent data, external resources, or registry entries\n- While optional, it's a best practice for integrations that register devices\n\nCurrent __init__.py has:\n- async_setup_entry ✓\n- async_unload_entry ✓\n- async_migrate_entry ✓\n- async_remove_entry ✗ (missing)\n\n## Fix Required\nAdd to __init__.py:\n\\`\\`\\`python\nasync def async_remove_entry(hass: HomeAssistant, entry: ConfigEntry) -\u003e None:\n    \"\"\"Handle removal of an entry.\"\"\"\n    # Clean up any persistent data if needed\n    # For this integration, device cleanup is automatic via entry_id in unique_id\n    pass\n\\`\\`\\`\n\n## Files Affected\n- custom_components/adguard_home_extended/__init__.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T18:40:05.083688-05:00","updated_at":"2025-12-17T18:51:51.775624-05:00","closed_at":"2025-12-17T18:51:51.775624-05:00"}
{"id":"homeassistant_adguard_home-7th","title":"Clean up ClientEntityManager on config entry unload","description":"## Problem\nThe \\`ClientEntityManager\\` subscribes to coordinator updates to dynamically add client entities, but its \\`async_unsubscribe()\\` method is never called when the config entry is unloaded. This creates memory leaks as the listener persists indefinitely.\n\n## Location\n- File: \\`switch.py\\` lines 85-89 (manager storage)\n- File: \\`__init__.py\\` lines 291-310 (async_unload_entry)\n\n## Current Code in async_unload_entry\n\\`\\`\\`python\nasync def async_unload_entry(hass: HomeAssistant, entry: ConfigEntry) -\u003e bool:\n    if unload_ok := await hass.config_entries.async_unload_platforms(entry, PLATFORMS):\n        hass.data[DOMAIN].pop(entry.entry_id)\n        # ../.. services cleanup but NO client manager cleanup\n\\`\\`\\`\n\n## Recommended Fix\n\\`\\`\\`python\nasync def async_unload_entry(hass: HomeAssistant, entry: ConfigEntry) -\u003e bool:\n    # Clean up client entity manager first\n    if client_manager := hass.data[DOMAIN].get(\"client_managers\", {}).pop(entry.entry_id, None):\n        client_manager.async_unsubscribe()\n    \n    if unload_ok := await hass.config_entries.async_unload_platforms(entry, PLATFORMS):\n        hass.data[DOMAIN].pop(entry.entry_id)\n        # ../.. rest of cleanup\n\\`\\`\\`\n\n## Rationale\nThe ClientEntityManager stores a reference via \\`self._unsubscribe = self._coordinator.async_add_listener(...)\\`. Without calling \\`async_unsubscribe()\\`, the coordinator retains a reference to the callback, preventing garbage collection and causing the callback to fire even after the entry is unloaded.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T17:08:14.280936-05:00","updated_at":"2025-12-17T17:16:46.90535-05:00","closed_at":"2025-12-17T17:16:46.90535-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-7th","depends_on_id":"homeassistant_adguard_home-a0m","type":"blocks","created_at":"2025-12-17T17:09:43.493577-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-810","title":"Add missing DNS rewrite API tests","description":"## Gap Identified\nThe following DNS rewrite methods in client.py lack unit tests:\n- \\`add_dns_rewrite()\\` - POST /control/rewrite/add\n- \\`update_dns_rewrite()\\` - PUT /control/rewrite/update\n- \\`delete_dns_rewrite()\\` - POST /control/rewrite/delete\n\n## File Locations\n- **API Client**: \\`custom_components/adguard_home_extended/api/client.py\\`\n- **Test File**: \\`tests/test_api_client.py\\` and \\`tests/test_dns_rewrite.py\\`\n- **Models**: \\`custom_components/adguard_home_extended/api/models.py\\` (DnsRewrite dataclass)\n- **Existing test pattern**: See \\`test_get_rewrites_success\\` in test_api_client.py\n\n## OpenAPI Reference\n\\`\\`\\`yaml\n/control/rewrite/add:\n  post:\n    summary: Add a new DNS rewrite rule\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/RewriteEntry'\n\n/control/rewrite/update:\n  put:\n    summary: Update a DNS rewrite rule\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/RewriteUpdate'\n\n/control/rewrite/delete:\n  post:\n    summary: Remove a DNS rewrite rule\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/RewriteEntry'\n\\`\\`\\`\n\n## Test Cases Needed\n1. test_add_dns_rewrite_success\n2. test_add_dns_rewrite_duplicate\n3. test_add_dns_rewrite_invalid_domain\n4. test_update_dns_rewrite_success\n5. test_update_dns_rewrite_not_found\n6. test_delete_dns_rewrite_success\n7. test_delete_dns_rewrite_not_found\n\n## Acceptance Criteria\n- [ ] All CRUD operations for rewrites have tests\n- [ ] Tests cover domain/answer validation\n- [ ] Duplicate handling tested\n- [ ] Tests pass with \\`pytest tests/test_api_client.py tests/test_dns_rewrite.py -v\\`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:21:07.013876-05:00","updated_at":"2025-12-17T20:26:34.857071-05:00"}
{"id":"homeassistant_adguard_home-8gd","title":"Add icons to entity descriptions","description":"## Problem\nEntity descriptions are missing icon definitions. Per Home Assistant 2025.12 best practices, entities should have appropriate MDI icons defined.\n\n## Research\nHome Assistant 2025.12 release notes mention improved support for trigger and condition category icons. Consistent entity icons improve UX and dashboard presentation.\n\nCurrent entities missing icons:\n- Sensors: dns_queries, blocked_queries, blocked_percentage, avg_processing_time, safe_browsing_blocked, parental_blocked, top_blocked_domain, top_client, dns_rewrites_count, dhcp_leases_count, dhcp_static_leases_count, recent_queries\n- Switches: protection, filtering, safe_browsing, parental_control, safe_search\n- Binary Sensors: running, protection_enabled, dhcp_enabled\n\n## Suggested Icons\n- dns_queries: mdi:dns\n- blocked_queries: mdi:shield-alert\n- blocked_percentage: mdi:percent\n- avg_processing_time: mdi:timer\n- protection: mdi:shield-check\n- filtering: mdi:filter\n- safe_browsing: mdi:shield-bug\n- parental_control: mdi:account-child\n- safe_search: mdi:shield-search\n- dhcp_enabled: mdi:ip-network\n- dns_rewrites_count: mdi:swap-horizontal\n\n## Files Affected\n- custom_components/adguard_home_extended/sensor.py\n- custom_components/adguard_home_extended/switch.py\n- custom_components/adguard_home_extended/binary_sensor.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T18:39:29.738252-05:00","updated_at":"2025-12-17T18:50:54.706705-05:00","closed_at":"2025-12-17T18:50:54.706705-05:00"}
{"id":"homeassistant_adguard_home-8hj","title":"Make sensor attribute list truncations configurable","description":"## Problem\nSensor attributes like top_blocked_domains and top_clients are truncated with hardcoded limits (\\`[:10]\\`, \\`[:20]\\`), which may not suit all users.\n\n## Location\n- File: \\`sensor.py\\` lines 107, 118, 134\n\n## Current Code Examples\n\\`\\`\\`python\n# Line 107\nattributes_fn=lambda data: (\n    {\"top_blocked_domains\": data.stats.top_blocked_domains[:10]}\n    if data.stats else {}\n),\n# Line 134\n{\"rewrites\": [...data.rewrites[:20]]}\n\\`\\`\\`\n\n## Recommended Enhancement\n1. Add constants: \\`DEFAULT_TOP_ITEMS_LIMIT = 10\\`, \\`DEFAULT_REWRITES_LIMIT = 20\\`\n2. Consider making configurable via options flow in future\n3. Use constants instead of magic numbers for now\n\n## Rationale\nPower users may want to see more items in sensor attributes for dashboards or automations, while constrained systems may prefer fewer. Using named constants improves code clarity and prepares for future configurability.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T17:08:59.713512-05:00","updated_at":"2025-12-17T18:09:50.172108-05:00","closed_at":"2025-12-17T18:09:50.172108-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-8hj","depends_on_id":"homeassistant_adguard_home-grl","type":"blocks","created_at":"2025-12-17T17:09:53.051426-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-8qg","title":"Implement access control API endpoints","description":"## Gap Identified\nThe OpenAPI spec defines access control endpoints for managing allowed/blocked clients and CIDR ranges that are not implemented.\n\n## Missing Endpoints\n- GET /control/access/list - Get access settings\n- POST /control/access/set - Update access settings\n\n## OpenAPI Schema Reference\n\\`\\`\\`yaml\n/control/access/list:\n  get:\n    summary: Get access list\n    responses:\n      200:\n        content:\n          application/json:\n            schema:\n              \\ref: '#/components/schemas/AccessList'\n\nAccessList:\n  type: object\n  properties:\n    allowed_clients:\n      type: array\n      items:\n        type: string\n      description: IP addresses or CIDRs allowed to use DNS\n    disallowed_clients:\n      type: array\n      items:\n        type: string\n      description: IP addresses or CIDRs blocked from using DNS\n    blocked_hosts:\n      type: array\n      items:\n        type: string\n      description: Hostnames blocked from resolution\n\\`\\`\\`\n\n## Value for HA Integration\n- Sensor showing count of allowed/blocked clients\n- Service to add/remove clients from access lists\n- Useful for parental controls or guest network isolation\n\n## Acceptance Criteria\n- [ ] Create AccessList model\n- [ ] Implement get_access_list() method\n- [ ] Implement set_access_list() method\n- [ ] Add unit tests","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-17T20:22:17.47366-05:00","updated_at":"2025-12-17T20:22:17.47366-05:00"}
{"id":"homeassistant_adguard_home-8uk","title":"Add async_set_unique_id in config_flow","description":"## Problem\nThe config flow uses \\`_async_abort_entries_match\\` to check for duplicates but never calls \\`async_set_unique_id()\\`. Without a unique ID, Home Assistant cannot reliably manage the config entry, which causes issues with entity registration, options flows, and re-authentication.\n\n## Location\n- File: \\`config_flow.py\\` lines 65-70\n\n## Current Code\n\\`\\`\\`python\nif user_input is not None:\n    # Check if already configured\n    self._async_abort_entries_match({CONF_HOST: user_input[CONF_HOST]})\n\\`\\`\\`\n\n## Recommended Fix\n\\`\\`\\`python\nif user_input is not None:\n    # Set unique_id before checking duplicates\n    unique_id = f\"{user_input[CONF_HOST]}:{user_input[CONF_PORT]}\"\n    await self.async_set_unique_id(unique_id)\n    self._abort_if_unique_id_configured()\n\\`\\`\\`\n\n## Rationale\nPer Home Assistant developer docs, config entries should have a unique_id set via \\`async_set_unique_id()\\` to enable proper entry management, prevent duplicates atomically, and support features like discovery and re-authentication.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-17T17:07:55.044779-05:00","updated_at":"2025-12-17T17:12:39.916612-05:00","closed_at":"2025-12-17T17:12:39.916612-05:00"}
{"id":"homeassistant_adguard_home-95o","title":"Add homeassistant minimum version to manifest.json","description":"## Problem\nThe manifest.json is missing the \\`homeassistant\\` minimum version constraint, which is required for HACS compatibility and ensures users have a compatible Home Assistant version.\n\n## Research\nPer Home Assistant developer docs and HACS requirements:\n- The \\`homeassistant\\` field specifies the minimum HA version the integration supports\n- This integration uses features from HA 2024.1.0+ (ConfigEntry typing, modern coordinator patterns)\n- Current pyproject.toml incorrectly specifies \\`homeassistant\u003e=2025.1.0\\` which is too restrictive\n\n## Fix Required\nAdd to manifest.json:\n\\`\\`\\`json\n\"homeassistant\": \"2024.1.0\"\n\\`\\`\\`\n\nAlso update pyproject.toml to match: \\`homeassistant\u003e=2024.1.0\\`\n\n## Files Affected\n- custom_components/adguard_home_extended/manifest.json\n- pyproject.toml","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T18:38:44.900068-05:00","updated_at":"2025-12-17T18:44:43.460388-05:00","closed_at":"2025-12-17T18:44:43.460388-05:00"}
{"id":"homeassistant_adguard_home-9f0","title":"Fix query log sensor attribute field names","description":"## Problem\nThe \\`recent_queries\\` sensor uses incorrect field names to extract query log data. It uses uppercase keys like \\`QH\\`, \\`IP\\`, \\`Answer\\`, \\`Reason\\` but the AdGuard Home API returns different field names.\n\n## Research\nPer AdGuard Home API documentation, query log entries use:\n- \\`question.name\\` or \\`question.host\\` for the domain (nested object)\n- \\`client\\` for the client IP/name (not \\`IP\\`)\n- \\`answer\\` is an array of objects with \\`value\\` field\n- \\`reason\\` is lowercase\n\n## Location\n- File: \\`custom_components/adguard_home_extended/sensor.py\\` lines 182-192\n\n## Fix Required\n\\`\\`\\`python\n'recent_queries': [\n    {\n        'domain': q.get('question', {}).get('name', ''),\n        'client': q.get('client', ''),\n        'answer': q.get('answer', [{}])[0].get('value', '') if q.get('answer') else '',\n        'reason': q.get('reason', ''),\n    }\n    for q in data.query_log[:10]\n]\n\\`\\`\\`","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T16:36:00.988431-05:00","updated_at":"2025-12-17T16:48:18.052793-05:00","closed_at":"2025-12-17T16:48:18.052793-05:00"}
{"id":"homeassistant_adguard_home-9l6","title":"Version mismatch between manifest.json and hacs.json","description":"## Problem\nmanifest.json specifies \\`homeassistant: 2024.1.0\\` while hacs.json specifies \\`homeassistant: 2025.1.0\\`.\n\n## Research\n- Home Assistant 2025.12 is the current release (December 2025)\n- AdGuard Home v0.107.69 is the latest stable release (October 30, 2025)\n- HACS requires version consistency for proper installation validation\n\n## Impact\n- Users may see confusing errors during installation\n- HACS validation may fail\n- Unclear minimum requirements for users\n\n## Solution\nAlign both files to \\`2025.1.0\\` (or \\`2025.12.0\\` for latest HA features). The manifest.json version is authoritative for Home Assistant, but HACS also reads hacs.json.\n\n## Files Affected\n- custom_components/adguard_home_extended/manifest.json\n- hacs.json","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T19:08:52.36109-05:00","updated_at":"2025-12-17T19:29:26.181611-05:00","closed_at":"2025-12-17T19:29:26.181611-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-9l6","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T19:11:08.826621-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-9rw","title":"Add DNS rewrite enable/disable support","description":"## Problem\nAdGuard Home v0.107.68 added the ability to enable/disable DNS rewrite rules without deleting them. This functionality is not exposed in the integration.\n\n## Research\nFrom AdGuard Home v0.107.68 release notes (October 23, 2025):\n\u003e New option to enable and disable DNS rewrite rules 🚦\n\nThis allows users to temporarily disable a rewrite rule without removing it, similar to how filter lists can be enabled/disabled.\n\n## Fix Required\n1. Update DnsRewrite model to include enabled field (if present in API)\n2. Add method to API client for toggling rewrite rules\n3. Consider adding switch entities for individual rewrite rules or a service to toggle them\n\n## Files Affected\n- custom_components/adguard_home_extended/api/models.py\n- custom_components/adguard_home_extended/api/client.py\n- custom_components/adguard_home_extended/services.yaml (optional)\n- custom_components/adguard_home_extended/__init__.py (optional service)","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T18:40:13.60224-05:00","updated_at":"2025-12-17T18:59:18.400768-05:00","closed_at":"2025-12-17T18:59:18.400768-05:00"}
{"id":"homeassistant_adguard_home-9we","title":"Add compatibility matrix to README","description":"## Problem\nUsers don't know which AdGuard Home version is required for which features.\n\n## Research\nDifferent features require different AGH versions:\n- v0.107.30+: Stats config, query log config APIs\n- v0.107.52+: Ecosia safe search\n- v0.107.56+: Blocked services with schedule, client search API\n- v0.107.65+: DNS cache enable/disable toggle\n- v0.107.68+: DNS rewrite enable/disable toggle\n- v0.107.69: Latest stable (October 2025)\n\nHome Assistant requirements:\n- 2025.1.0+ recommended for latest patterns\n- 2025.12 is current (December 2025)\n\n## Solution\nAdd a compatibility table to README.md:\n\n| Integration Version | Min AdGuard Home | Min Home Assistant | Notes |\n|---------------------|------------------|-------------------|-------|\n| 0.1.x | 0.107.30 | 2025.1.0 | Base functionality |\n| 0.2.x | 0.107.56 | 2025.1.0 | + Scheduled blocked services |\n| 0.3.x | 0.107.68 | 2025.1.0 | + DNS rewrite toggles |\n\n## Files Affected\n- README.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:10:01.532143-05:00","updated_at":"2025-12-17T19:29:57.48448-05:00","closed_at":"2025-12-17T19:29:57.48448-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-9we","depends_on_id":"homeassistant_adguard_home-9l6","type":"blocks","created_at":"2025-12-17T19:10:30.560993-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-9we","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T19:11:08.862165-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-a0m","title":"Fix service registration race condition","description":"## Problem\nThe current service registration uses \\`hass.services.has_service()\\` which is not atomic and can lead to race conditions if multiple AdGuard Home instances are set up concurrently.\n\n## Location\n- File: \\`__init__.py\\` lines 101-102\n\n## Current Code\n\\`\\`\\`python\n# Register services only once (first entry)\nif not hass.services.has_service(DOMAIN, SERVICE_SET_BLOCKED_SERVICES):\n    await _async_setup_services(hass)\n\\`\\`\\`\n\n## Recommended Fix\n\\`\\`\\`python\n# Track registration state atomically in hass.data\nif not hass.data[DOMAIN].get(\"services_registered\"):\n    await _async_setup_services(hass)\n    hass.data[DOMAIN][\"services_registered\"] = True\n\\`\\`\\`\n\n## Rationale\nThe \\`has_service\\` check is not atomic - if two config entries are set up at the same time (e.g., during HA startup with multiple AdGuard instances), both could pass the check before either registers, leading to duplicate registration attempts or other undefined behavior. Tracking state in \\`hass.data\\` provides atomic check-and-set semantics within the event loop.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-17T17:08:03.759662-05:00","updated_at":"2025-12-17T17:13:03.609237-05:00","closed_at":"2025-12-17T17:13:03.609237-05:00"}
{"id":"homeassistant_adguard_home-a2b","title":"Dynamic client entity updates","description":"## Problem\nPer-client entities (filtering, parental, safebrowsing switches for each AdGuard client) are created only during integration setup. If users add, remove, or rename clients in AdGuard Home, the entities become stale and don't reflect the changes until a full integration reload.\n\n## Research\n- Home Assistant entity registry supports dynamic entity creation\n- Best practice is to compare current entities with coordinator data on updates\n- Some integrations use \\`async_add_entities\\` callbacks from coordinator listeners\n\n## Location\n- File: \\`custom_components/adguard_home_extended/client_entities.py\\` (current static creation)\n- File: \\`custom_components/adguard_home_extended/switch.py\\` lines 76-80 (setup entry)\n\n## Implementation\n1. Track created client entity IDs\n2. Add coordinator listener in switch platform setup\n3. On data refresh, compare \\`coordinator.data.clients\\` with tracked entities\n4. Call \\`async_add_entities\\` for new clients\n5. Optionally: mark removed client entities as unavailable or remove them","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T16:35:51.866033-05:00","updated_at":"2025-12-17T17:00:53.019279-05:00","closed_at":"2025-12-17T17:00:53.019279-05:00"}
{"id":"homeassistant_adguard_home-a43","title":"Integration Audit Q4 2025: Code Quality \u0026 API Improvements","description":"Comprehensive audit findings from December 17, 2025 review of the AdGuard Home Extended integration.\n\n## Research Context\nPerplexity search conducted on Dec 17, 2025 targeting:\n- **AdGuard Home**: v0.107.69 (released Oct 30, 2025) - Latest stable\n- **Home Assistant**: 2025.12 (Dec 2025 release)\n- **HACS**: 2.0+\n\n## Current Integration Assessment: A- (Excellent)\nThe integration follows Home Assistant best practices including:\n- Modern ConfigEntry.runtime_data pattern (HA 2024.8+)\n- DataUpdateCoordinator with _async_setup() \n- Proper entity naming with _attr_has_entity_name\n- Comprehensive API coverage\n- Good version detection and feature flags\n- 11 well-documented services with multi-instance support\n\n## Areas for Improvement Identified\n1. Missing explicit API request timeouts (HIGH)\n2. DNS rewrite enabled field not supported - v0.107.68 feature (MEDIUM)\n3. Service translations missing from strings.json (MEDIUM)\n4. Diagnostics output review needed (LOW)\n\n## Out of Scope (per user request)\n- DHCP discovery hostname pattern matching\n- Supporting HA versions older than 2025.1.0","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-17T21:09:37.467765-05:00","updated_at":"2025-12-17T21:18:40.680729-05:00","closed_at":"2025-12-17T21:18:40.680729-05:00"}
{"id":"homeassistant_adguard_home-ark","title":"Add SSDP/MDNS device discovery","description":"## Rationale\nHome Assistant supports automatic device discovery via SSDP and MDNS/Zeroconf. Adding discovery support would allow users to set up the integration without manually entering host/port.\n\n### Discovery Methods\n1. **MDNS/Zeroconf**: AdGuard Home doesn't advertise by default, but could detect via DNS port\n2. **SSDP**: Not supported by AdGuard Home\n3. **Network scan**: Could detect AdGuard Home web interface on common ports (80, 3000, 8080)\n\n### Implementation Approach\nSince AdGuard Home doesn't natively advertise discovery services, options are limited:\n1. **DHCP discovery**: If AdGuard Home is DHCP server, could detect via DHCP options\n2. **Manual discovery trigger**: Add a 'scan network' button in config flow\n3. **Future**: Request AdGuard team add MDNS advertisement\n\n### Complexity\n- Low priority as AdGuard Home doesn't support native discovery\n- Would require network scanning which has security implications\n- Better to wait for upstream AdGuard Home support\n\n### References\n- HA Discovery docs: https://developers.home-assistant.io/docs/creating_integration_manifest/#zeroconf\n- AdGuard Home feature request could be filed upstream","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T19:56:26.512868-05:00","updated_at":"2025-12-17T20:31:25.101985-05:00","closed_at":"2025-12-17T20:31:25.101985-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-ark","depends_on_id":"homeassistant_adguard_home-mcg","type":"blocks","created_at":"2025-12-17T19:57:24.415918-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-azp","title":"Enhance DHCP discovery for auto-configuration","description":"## Current State\nmanifest.json has DHCP discovery configured:\n\\`\\`\\`json\n\"dhcp\": [{\"registered_devices\": true}]\n\\`\\`\\`\n\nThis only updates IP addresses for already-configured devices when they change on the network.\n\n## Potential Enhancement\nIf AdGuard Home devices have known MAC address prefixes or other identifiable characteristics, we could add auto-discovery:\n\\`\\`\\`json\n\"dhcp\": [\n  {\"registered_devices\": true},\n  {\"macaddress\": \"AA:BB:CC:*\"}  // If AGH uses known MACs\n]\n\\`\\`\\`\n\n## Research Findings\n- AdGuard Home runs on various hardware, no consistent MAC prefix\n- Primary value is registered_devices for IP change tracking\n- Zeroconf/mDNS not typically advertised by AGH\n\n## Recommendation\nCurrent implementation is appropriate. Mark as low priority / won't fix unless user feedback indicates need.\n\n## Research Source\nPerplexity search Dec 17, 2025 - AdGuard Home discovery protocols\n\n## Impact\n- Low priority - current discovery works for intended use case\n- No action needed unless AGH adds discovery protocols","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T20:40:44.139314-05:00","updated_at":"2025-12-17T21:01:18.225249-05:00","closed_at":"2025-12-17T21:01:18.225249-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-azp","depends_on_id":"homeassistant_adguard_home-lyi","type":"blocks","created_at":"2025-12-17T20:41:20.088065-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-b2b","title":"Implement TLS configuration API endpoints","description":"## Gap Identified\nThe OpenAPI spec defines TLS/HTTPS configuration endpoints that are not currently implemented in the client.\n\n## File Locations\n- **API Client**: \\`custom_components/adguard_home_extended/api/client.py\\` - add new methods\n- **Models**: \\`custom_components/adguard_home_extended/api/models.py\\` - add TlsConfig dataclass\n- **Constants**: \\`custom_components/adguard_home_extended/const.py\\` - add endpoint URLs\n- **Test File**: \\`tests/test_api_client.py\\` - add tests for new methods\n\n## Missing Endpoints\n- GET /control/tls/status - Get current TLS configuration\n- POST /control/tls/configure - Update TLS settings\n- POST /control/tls/validate - Validate TLS certificate/key\n\n## OpenAPI Schema Reference\n\\`\\`\\`yaml\n/control/tls/status:\n  get:\n    summary: Returns TLS configuration and status\n    responses:\n      200:\n        content:\n          application/json:\n            schema:\n              \\ref: '#/components/schemas/TlsConfig'\n\nTlsConfig:\n  type: object\n  properties:\n    enabled:\n      type: boolean\n    server_name:\n      type: string\n    force_https:\n      type: boolean\n    port_https:\n      type: integer\n    port_dns_over_tls:\n      type: integer\n    port_dns_over_quic:\n      type: integer\n    certificate_chain:\n      type: string\n    private_key:\n      type: string\n    certificate_path:\n      type: string\n    private_key_path:\n      type: string\n    valid_cert:\n      type: boolean\n    valid_chain:\n      type: boolean\n    valid_key:\n      type: boolean\n    valid_pair:\n      type: boolean\n\\`\\`\\`\n\n## Implementation Steps\n1. Add to const.py:\n   \\`\\`\\`python\n   URL_TLS_STATUS = '/control/tls/status'\n   URL_TLS_CONFIGURE = '/control/tls/configure'\n   \\`\\`\\`\n\n2. Add to models.py:\n   \\`\\`\\`python\n   @dataclass\n   class TlsConfig:\n       enabled: bool = False\n       server_name: str | None = None\n       # ../.. other fields\n   \\`\\`\\`\n\n3. Add to client.py:\n   \\`\\`\\`python\n   async def get_tls_status(self) -\u003e TlsConfig:\n       ../..\n   \\`\\`\\`\n\n## Value for HA Integration\n- Binary sensor for TLS validity status\n- Sensor for certificate expiration\n- Switch to enable/disable HTTPS redirect\n\n## Acceptance Criteria\n- [ ] Create TlsConfig dataclass in models.py\n- [ ] Add URL constants to const.py\n- [ ] Implement \\`get_tls_status()\\` method in client.py\n- [ ] Implement \\`set_tls_config()\\` method in client.py\n- [ ] Add unit tests for all new methods\n- [ ] Tests pass with \\`pytest tests/test_api_client.py -v\\`\n- [ ] Document security considerations (don't log private keys)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-17T20:22:09.953681-05:00","updated_at":"2025-12-17T20:28:08.283515-05:00"}
{"id":"homeassistant_adguard_home-bh1","title":"Fix filtering switch to use correct API endpoint","description":"## Problem\nThe Filtering switch reads state from \\`data.filtering.enabled\\` but its \\`turn_on_fn\\` and \\`turn_off_fn\\` both call \\`client.set_protection()\\`. Protection and Filtering are different features in AdGuard Home.\n\n## Research\n- AdGuard Home has separate endpoints for protection vs filtering\n- \\`/control/protection\\` - Master protection toggle\n- \\`/control/filtering/config\\` or \\`/control/dns_config\\` - Filtering toggle\n- The current implementation toggles the wrong feature when user clicks the Filtering switch\n\n## Location\n- File: \\`custom_components/adguard_home_extended/switch.py\\` lines 42-45\n- File: \\`custom_components/adguard_home_extended/api/client.py\\` (missing method)\n\n## Fix Required\n1. Add new API method in \\`client.py\\`:\n\\`\\`\\`python\nasync def set_filtering(self, enabled: bool) -\u003e None:\n    await self._post('/control/filtering/config', {'enabled': enabled})\n\\`\\`\\`\n\n2. Update switch in \\`switch.py\\`:\n\\`\\`\\`python\nturn_on_fn=lambda client: client.set_filtering(True),\nturn_off_fn=lambda client: client.set_filtering(False),\n\\`\\`\\`","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T16:34:59.319197-05:00","updated_at":"2025-12-17T16:43:24.54233-05:00","closed_at":"2025-12-17T16:43:24.54233-05:00"}
{"id":"homeassistant_adguard_home-bjp","title":"HACS and repository setup","description":"Create hacs.json, README.md with installation/usage docs, LICENSE file. Prepare for HACS default repository submission","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:53:23.778905-05:00","updated_at":"2025-12-17T16:00:31.908492-05:00","closed_at":"2025-12-17T16:00:31.908492-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-bjp","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:39.131375-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-bq0","title":"Utilize clients/search API instead of deprecated clients/find","description":"## Problem\nThe API constant \\`API_CLIENTS_SEARCH\\` is defined but not used. AdGuard Home deprecated the old \\`/control/clients/find\\` endpoint.\n\n## Research\nFrom AdGuard Home API changelog v0.107.56:\n\u003e Deprecated: \\`GET /control/clients/find\\` HTTP API; use the new \\`POST /control/clients/search\\` API instead.\n\nThe new API accepts:\n\\`\\`\\`json\n{\n  \"clients\": [\n    {\"id\": \"192.0.2.1\"},\n    {\"id\": \"test\"}\n  ]\n}\n\\`\\`\\`\n\n## Benefits\n- More efficient client lookups\n- Supports batch queries\n- Future-proof against API deprecation\n\n## Implementation\n1. Add \\`search_clients(client_ids: list[str])\\` method to client.py\n2. Use for client entity lookups where applicable\n3. Keep backwards compatibility for older AGH versions\n\n## Files Affected\n- custom_components/adguard_home_extended/api/client.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:09:18.246427-05:00","updated_at":"2025-12-17T19:38:21.875177-05:00","closed_at":"2025-12-17T19:38:21.875177-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-bq0","depends_on_id":"homeassistant_adguard_home-xok","type":"blocks","created_at":"2025-12-17T19:10:50.758809-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-bws","title":"Per-client filtering entities","description":"Create entities for per-client control: enable/disable filtering per device, per-client parental controls, per-client blocked services","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:52:51.282419-05:00","updated_at":"2025-12-17T16:06:24.206008-05:00","closed_at":"2025-12-17T16:06:24.206008-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-bws","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.868684-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-bws","depends_on_id":"homeassistant_adguard_home-5k9","type":"blocks","created_at":"2025-12-17T15:53:47.478959-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-bwx","title":"Implement OptionsFlow for configurable scan interval","description":"## Problem\nUsers cannot modify the scan interval (polling frequency) after initial setup. The \\`DEFAULT_SCAN_INTERVAL\\` of 30 seconds is hardcoded. Some users may want faster updates, others may want to reduce API calls.\n\n## Research\n- HACS integrations commonly provide OptionsFlow for polling configuration\n- Home Assistant DataUpdateCoordinator supports dynamic update intervals\n- The official AdGuard Home core integration also lacks this, but it's a good enhancement opportunity\n\n## Location\n- File: \\`custom_components/adguard_home_extended/config_flow.py\\` (add OptionsFlowHandler)\n- File: \\`custom_components/adguard_home_extended/coordinator.py\\` (read from entry.options)\n- File: \\`custom_components/adguard_home_extended/const.py\\` (add config key)\n\n## Implementation\n1. Add \\`OptionsFlowHandler\\` class to config_flow.py\n2. Register options flow in \\`AdGuardHomeConfigFlow\\`\n3. Update coordinator to read interval from \\`entry.options.get(CONF_SCAN_INTERVAL, DEFAULT_SCAN_INTERVAL)\\`\n4. Add listener for options updates to apply changes without restart","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T16:35:42.183542-05:00","updated_at":"2025-12-17T16:58:44.244358-05:00","closed_at":"2025-12-17T16:58:44.244358-05:00"}
{"id":"homeassistant_adguard_home-cbd","title":"Add per-client upstream cache configuration support","description":"## Background\nNewer AdGuard Home versions support per-client custom upstream DNS cache configuration.\n\n## API Fields\nFrom \\`GET /control/clients\\` response, each client can have:\n\\`\\`\\`json\n{\n  \"name\": \"Client Name\",\n  \"upstreams_cache_enabled\": true,\n  \"upstreams_cache_size\": 4096,\n  ../..\n}\n\\`\\`\\`\n\n## Current State\nThe \\`AdGuardHomeClient\\` model doesn't include these fields. Client entities don't expose cache configuration.\n\n## Required Changes\n1. Add to \\`AdGuardHomeClient\\` model:\n\\`\\`\\`python\nupstreams_cache_enabled: bool = True\nupstreams_cache_size: int = 0\n\\`\\`\\`\n\n2. Include in client data fetching in coordinator\n3. Optionally add sensor/switch for per-client cache control\n\n## Research Source\nAdGuard Home CHANGELOG: 'Added new properties clients.persistent.*.upstreams_cache_enabled and clients.persistent.*.upstreams_cache_size that describe cache configuration for each client's custom upstream configuration'","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T18:17:33.375563-05:00","updated_at":"2025-12-17T18:35:30.866823-05:00","closed_at":"2025-12-17T18:35:30.866823-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-cbd","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:18:02.001163-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-cbd","depends_on_id":"homeassistant_adguard_home-nux","type":"blocks","created_at":"2025-12-17T18:18:06.571384-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-csl","title":"Synchronize HA version requirements between pyproject.toml and hacs.json","description":"## Problem\nThere's a mismatch between Home Assistant version requirements:\n\n**pyproject.toml:**\n\\`\\`\\`toml\ndependencies = [\n    \"homeassistant\u003e=2024.1.0\",\n    ../..\n]\n\\`\\`\\`\n\n**hacs.json:**\n\\`\\`\\`json\n{\n  \"homeassistant\": \"2025.1.0\",\n  ../..\n}\n\\`\\`\\`\n\n## Impact\n- pyproject.toml says HA 2024.1.0+ is supported\n- hacs.json says HA 2025.1.0+ is required\n- This creates confusion and may cause HACS to block installation on valid HA versions\n\n## Required Fix\nSynchronize both files to the same minimum version. Recommendation:\n- If targeting latest features: both should be \\`2024.12.0\\` or \\`2025.1.0\\`\n- If targeting wider compatibility: both should be \\`2024.1.0\\`\n\n## Research Source\nHACS documentation states that \\`homeassistant\\` field in hacs.json is the minimum version required for the integration to work","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T18:16:57.798437-05:00","updated_at":"2025-12-17T18:23:22.414455-05:00","closed_at":"2025-12-17T18:23:22.414455-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-csl","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:17:57.286499-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-d5w","title":"Add manifest.json quality_scale and loggers fields","description":"## Background\nHACS and Home Assistant best practices recommend additional manifest.json fields for better integration quality scoring and debugging.\n\n## Current manifest.json\n\\`\\`\\`json\n{\n  \"domain\": \"adguard_home_extended\",\n  \"name\": \"AdGuard Home Extended\",\n  \"codeowners\": [\"@carpenike\"],\n  \"config_flow\": true,\n  \"dependencies\": [],\n  \"documentation\": \"https://github.com/carpenike/homeassistant_adguard_home\",\n  \"iot_class\": \"local_polling\",\n  \"issue_tracker\": \"https://github.com/carpenike/homeassistant_adguard_home/issues\",\n  \"requirements\": [],\n  \"version\": \"0.1.0\",\n  \"integration_type\": \"hub\"\n}\n\\`\\`\\`\n\n## Required Changes\nAdd these fields:\n\\`\\`\\`json\n{\n  \"quality_scale\": \"silver\",\n  \"loggers\": [\"custom_components.adguard_home_extended\"]\n}\n\\`\\`\\`\n\n## Rationale\n- \\`quality_scale\\`: Indicates integration meets silver-tier quality standards\n- \\`loggers\\`: Enables proper log filtering in HA settings\n\n## Research Source\nHome Assistant Developer Docs - Manifest requirements for quality integrations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T18:16:17.143899-05:00","updated_at":"2025-12-17T18:24:24.997417-05:00","closed_at":"2025-12-17T18:24:24.997417-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-d5w","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:17:52.305736-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-d5w","depends_on_id":"homeassistant_adguard_home-csl","type":"blocks","created_at":"2025-12-17T18:18:10.655008-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-dcm","title":"Add EntityCategory.DIAGNOSTIC to diagnostic sensors","description":"## Problem\nSensors that provide statistics or debugging information (dns_rewrites_count, dhcp_leases_count, dhcp_static_leases_count, recent_queries, avg_processing_time) are not marked with \\`EntityCategory.DIAGNOSTIC\\`, causing them to appear in the main entity list rather than being organized under diagnostics.\n\n## Location\n- File: \\`sensor.py\\` - multiple sensor descriptions\n\n## Affected Sensors\n- \\`dns_rewrites_count\\` (line ~117) - already has it ✓\n- \\`dhcp_leases_count\\` (line ~130) - already has it ✓\n- \\`dhcp_static_leases_count\\` - needs verification\n- \\`avg_processing_time\\` (line ~63) - already has it ✓\n- \\`recent_queries\\` - needs verification\n\n## Recommended Fix\nFor any sensor without the category, add:\n\\`\\`\\`python\nentity_category=EntityCategory.DIAGNOSTIC,\n\\`\\`\\`\n\n## Rationale\nHome Assistant's \\`EntityCategory.DIAGNOSTIC\\` helps organize entities in the UI. Diagnostic entities are hidden from the default entity list and grouped separately in device pages, improving UX by reducing clutter and clearly indicating which entities are informational vs. actionable.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T17:09:28.012233-05:00","updated_at":"2025-12-17T17:15:53.131142-05:00","closed_at":"2025-12-17T17:15:53.131142-05:00"}
{"id":"homeassistant_adguard_home-dtv","title":"Migrate from hass.data to entry.runtime_data pattern","description":"## Problem\nHome Assistant (2024+) recommends using \\`entry.runtime_data\\` instead of \\`hass.data[DOMAIN][entry_id]\\` for storing coordinator and runtime data.\n\n## Benefits of runtime_data\n1. **Type safety** - ConfigEntry is now generic: \\`ConfigEntry[MyData]\\`\n2. **Auto-cleanup** - No manual deletion needed in async_unload_entry\n3. **Cleaner code** - Direct access via \\`entry.runtime_data\\`\n\n## Current Implementation (__init__.py)\n\\`\\`\\`python\nhass.data.setdefault(DOMAIN, {})\nhass.data[DOMAIN][entry.entry_id] = coordinator\n\\`\\`\\`\n\n## Recommended Pattern (HA 2024+)\n\\`\\`\\`python\n# At module level\ntype AdGuardHomeConfigEntry = ConfigEntry[AdGuardHomeDataUpdateCoordinator]\n\n# In async_setup_entry\nentry.runtime_data = coordinator\n\n# In platform setup\ncoordinator = entry.runtime_data\n\\`\\`\\`\n\n## Research Source\nPerplexity search Dec 17, 2025 - Home Assistant Developer Blog 2024 patterns, DataUpdateCoordinator documentation.\n\n## Impact\n- Medium priority - current approach works but new pattern is recommended\n- Reduces boilerplate in unload handling\n- Enables better type checking","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T20:39:56.073031-05:00","updated_at":"2025-12-17T20:52:40.634469-05:00","closed_at":"2025-12-17T20:52:40.634469-05:00"}
{"id":"homeassistant_adguard_home-e0q","title":"Add missing protection toggle API tests","description":"## Gap Identified\nThe following protection toggle methods in client.py lack unit tests:\n- \\`set_safebrowsing()\\` - POST /control/safebrowsing/enable or /disable\n- \\`set_parental()\\` - POST /control/parental/enable or /disable\n- \\`set_safesearch()\\` - POST /control/safesearch/enable or /disable\n\n## File Locations\n- **API Client**: \\`custom_components/adguard_home_extended/api/client.py\\`\n- **Test File**: \\`tests/test_api_client.py\\`\n- **Existing test pattern**: See \\`test_set_protection_enable\\`, \\`test_set_protection_disable\\` in test_api_client.py\n\n## OpenAPI Reference\n\\`\\`\\`yaml\n/control/safebrowsing/enable:\n  post:\n    summary: Enable safebrowsing\n\n/control/safebrowsing/disable:\n  post:\n    summary: Disable safebrowsing\n\n/control/parental/enable:\n  post:\n    summary: Enable parental filtering\n\n/control/parental/disable:\n  post:\n    summary: Disable parental filtering\n\n/control/safesearch/settings:\n  put:\n    summary: Update safesearch settings\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/SafeSearchConfig'\n\\`\\`\\`\n\n## Test Cases Needed\n1. test_set_safebrowsing_enable\n2. test_set_safebrowsing_disable\n3. test_set_parental_enable\n4. test_set_parental_disable\n5. test_set_safesearch_enable\n6. test_set_safesearch_disable\n7. test_protection_toggles_when_already_in_state (idempotency)\n\n## Acceptance Criteria\n- [ ] Enable/disable paths tested for each protection type\n- [ ] Idempotent behavior verified\n- [ ] Error handling for API failures tested\n- [ ] Tests pass with \\`pytest tests/test_api_client.py -v\\`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:21:22.326594-05:00","updated_at":"2025-12-17T20:26:54.08471-05:00"}
{"id":"homeassistant_adguard_home-elu","title":"Update Status model to match OpenAPI schema","description":"## Gap Identified\nThe Status model in models.py is missing fields defined in the OpenAPI spec.\n\n## File Locations\n- **Models File**: \\`custom_components/adguard_home_extended/api/models.py\\`\n- **Model Class**: \\`AdGuardHomeStatus\\` dataclass (around line 50-70)\n- **Test File**: \\`tests/test_models.py\\`\n- **API Client Usage**: \\`custom_components/adguard_home_extended/api/client.py\\` - \\`get_status()\\` method\n\n## Current Model Fields\n- dns_addresses\n- dns_port\n- http_port\n- protection_enabled\n- running\n- version\n\n## Missing Fields (per OpenAPI)\n- \\`protection_disabled_duration\\` (integer) - Duration protection is disabled for in milliseconds\n- \\`dhcp_available\\` (boolean) - Whether DHCP is available on this system\n- \\`language\\` (string) - Current UI language setting\n\n## OpenAPI Schema Reference\n\\`\\`\\`yaml\nStatus:\n  type: object\n  properties:\n    dns_addresses:\n      type: array\n      items:\n        type: string\n    dns_port:\n      type: integer\n    http_port:\n      type: integer\n    protection_enabled:\n      type: boolean\n    protection_disabled_duration:\n      type: integer\n      description: Duration in milliseconds\n    dhcp_available:\n      type: boolean\n    running:\n      type: boolean\n    version:\n      type: string\n    language:\n      type: string\n\\`\\`\\`\n\n## Acceptance Criteria\n- [ ] Add \\`protection_disabled_duration: int | None = None\\` field\n- [ ] Add \\`dhcp_available: bool = False\\` field\n- [ ] Add \\`language: str | None = None\\` field\n- [ ] Update \\`from_dict()\\` parsing logic to handle new fields\n- [ ] Add corresponding tests in test_models.py\n- [ ] Tests pass with \\`pytest tests/test_models.py -v\\`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:21:30.812264-05:00","updated_at":"2025-12-17T20:27:04.57034-05:00"}
{"id":"homeassistant_adguard_home-emr","title":"DHCP sensors","description":"Create sensors for DHCP data: active leases count, static leases, lease details as attributes","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T15:53:09.04395-05:00","updated_at":"2025-12-17T16:26:16.852387-05:00","closed_at":"2025-12-17T16:26:16.852387-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-emr","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:39.020783-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-emr","depends_on_id":"homeassistant_adguard_home-5k9","type":"blocks","created_at":"2025-12-17T15:53:47.632668-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-f4m","title":"Add __init__.py service handler tests","description":"## Coverage Gap\n\\`__init__.py\\` has 40% coverage (117 lines missing).\n\n## Missing Coverage (lines 174-465)\n- Service registration logic\n- Service handler functions:\n  - \\`_async_handle_set_blocked_services\\`\n  - \\`_async_handle_add_filter_url\\`\n  - \\`_async_handle_remove_filter_url\\`\n  - \\`_async_handle_refresh_filters\\`\n  - \\`_async_handle_set_client_blocked_services\\`\n  - \\`_async_handle_add_dns_rewrite\\`\n  - \\`_async_handle_remove_dns_rewrite\\`\n  - \\`_async_handle_check_host\\`\n  - \\`_async_handle_get_query_log\\`\n  - \\`_async_handle_clear_query_log\\`\n  - \\`_async_handle_reset_stats\\`\n\n## Test Cases Needed\n1. test_service_set_blocked_services\n2. test_service_add_filter_url\n3. test_service_remove_filter_url\n4. test_service_refresh_filters\n5. test_service_set_client_blocked_services\n6. test_service_add_dns_rewrite\n7. test_service_remove_dns_rewrite\n8. test_service_check_host\n9. test_service_get_query_log\n10. test_service_clear_query_log\n11. test_service_reset_stats\n12. test_service_multi_instance_entry_id\n\n## Files to Modify\n- \\`tests/test_init.py\\`\n\n## Acceptance Criteria\n- [ ] All 11 service handlers have tests\n- [ ] Multi-instance entry_id parameter tested\n- [ ] Error cases covered","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T21:21:19.759535-05:00","updated_at":"2025-12-17T21:25:53.087428-05:00","closed_at":"2025-12-17T21:25:53.087428-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-f4m","depends_on_id":"homeassistant_adguard_home-x5q","type":"blocks","created_at":"2025-12-17T21:22:14.799222-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-ft3","title":"Make query log limit configurable via options flow","description":"## Problem\nThe coordinator always fetches 100 query log entries, which may be insufficient for power users or excessive for others, potentially impacting performance.\n\n## Location\n- File: \\`coordinator.py\\` line 129\n\n## Current Code\n\\`\\`\\`python\ndata.query_log = await self.client.get_query_log(limit=100)\n\\`\\`\\`\n\n## Recommended Enhancement\n1. Add \\`query_log_limit\\` option to \\`AdGuardHomeOptionsFlow\\` in config_flow.py\n2. Store in entry.options with default of 100\n3. Read from options in coordinator:\n\\`\\`\\`python\nquery_limit = entry.options.get(CONF_QUERY_LOG_LIMIT, DEFAULT_QUERY_LOG_LIMIT)\ndata.query_log = await self.client.get_query_log(limit=query_limit)\n\\`\\`\\`\n\n## Rationale\nUsers with high query volumes may want more history, while users concerned about performance/memory may want fewer entries. Making this configurable follows the pattern already established with scan_interval in the options flow.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T17:08:50.788432-05:00","updated_at":"2025-12-17T18:05:50.447187-05:00","closed_at":"2025-12-17T18:05:50.447187-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-ft3","depends_on_id":"homeassistant_adguard_home-grl","type":"blocks","created_at":"2025-12-17T17:09:48.927131-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-grl","title":"Pass config_entry parameter to DataUpdateCoordinator","description":"## Problem\nThe DataUpdateCoordinator manually sets \\`self.config_entry = entry\\` but doesn't pass it to the parent \\`super().__init__()\\`. Modern Home Assistant (2023.8+) expects the \\`config_entry\\` parameter in the coordinator init.\n\n## Location\n- File: \\`coordinator.py\\` lines 55-68\n\n## Current Code\n\\`\\`\\`python\nsuper().__init__(\n    hass,\n    _LOGGER,\n    name=DOMAIN,\n    update_interval=timedelta(seconds=scan_interval),\n)\nself.client = client\nself.config_entry = entry\n\\`\\`\\`\n\n## Recommended Fix\n\\`\\`\\`python\nsuper().__init__(\n    hass,\n    _LOGGER,\n    name=DOMAIN,\n    update_interval=timedelta(seconds=scan_interval),\n    config_entry=entry,  # Pass to parent\n)\nself.client = client\n# self.config_entry is now set by parent\n\\`\\`\\`\n\n## Rationale\nThe DataUpdateCoordinator base class handles config_entry lifecycle events when passed as a parameter. This enables features like automatic reload on config changes and proper logging context. The current approach works but may miss future HA framework improvements.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T17:08:33.234459-05:00","updated_at":"2025-12-17T17:14:11.780389-05:00","closed_at":"2025-12-17T17:14:11.780389-05:00"}
{"id":"homeassistant_adguard_home-h06","title":"Keep blocked services list current with new AGH services","description":"## Problem\nAdGuard Home regularly adds new blockable services that should be reflected in the integration.\n\n## Research\nRecent additions to AdGuard Home blocked services:\n- v0.107.66: ChatGPT, Claude, DeepSeek, Odysee\n- Earlier: Various social media, gaming, streaming services\n\nThe integration fetches available services dynamically via \\`GET /control/blocked_services/all\\`, so the list stays current automatically.\n\n## Current State\n✅ Services are fetched dynamically - no hardcoding\n✅ SafeSearchSettings model includes Ecosia (v0.107.52)\n✅ Blocked services with schedule supported (v0.107.56+)\n\n## Remaining Work\n- Ensure UI/docs mention that service list is dynamic\n- Consider caching service metadata (icons, names) for offline use\n- Add tests for new service handling\n\n## Impact\nLow - the dynamic fetching handles this automatically. This is more of a documentation/awareness task.\n\n## Files Affected\n- README.md (documentation)\n- tests/test_blocked_services.py (if adding tests)","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-17T19:10:11.225919-05:00","updated_at":"2025-12-17T19:45:17.517787-05:00","closed_at":"2025-12-17T19:45:17.517787-05:00"}
{"id":"homeassistant_adguard_home-h2a","title":"Add query log response_status filtering","description":"## Feature Request\nAdd support for filtering query log by response status.\n\n## Research\nThe AdGuard Home query log API supports a \\`response_status\\` parameter:\n- \\`all\\` - All queries\n- \\`filtered\\` - Only filtered/blocked queries\n\nFrom openapi.yaml:\n\\`\\`\\`yaml\n- name: 'response_status'\n  in: 'query'\n  description: 'Filter by response status'\n  schema:\n    type: 'string'\n    enum:\n      - 'all'\n      - 'filtered'\n\\`\\`\\`\n\n## Current State\nThe \\`get_query_log()\\` method only supports \\`limit\\`, \\`offset\\`, and \\`search\\` parameters.\n\n## Benefits\n- More efficient queries when only blocked requests are needed\n- Reduces data transfer for large query logs\n- Better filtering for diagnostics\n\n## Implementation\nAdd \\`response_status\\` parameter to \\`get_query_log()\\`:\n\\`\\`\\`python\nasync def get_query_log(\n    self,\n    limit: int = 100,\n    offset: int = 0,\n    search: str | None = None,\n    response_status: str | None = None,  # 'all' or 'filtered'\n) -\u003e list[dict]:\n\\`\\`\\`\n\n## Files Affected\n- custom_components/adguard_home_extended/api/client.py","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T19:09:26.156891-05:00","updated_at":"2025-12-17T19:42:52.222214-05:00","closed_at":"2025-12-17T19:42:52.222214-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-h2a","depends_on_id":"homeassistant_adguard_home-xok","type":"blocks","created_at":"2025-12-17T19:10:38.668233-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-ha1","title":"Sync translations/en.json with strings.json","description":"## Problem\nHome Assistant uses both \\`strings.json\\` and \\`translations/en.json\\` for localization. These files should be identical for the English locale, but they may have drifted apart.\n\n## Research\n- \\`strings.json\\` is the source of truth for config flow strings\n- \\`translations/en.json\\` is loaded by Home Assistant for runtime translations\n- Best practice: keep them synchronized or use a build process\n\n## Location\n- File: \\`custom_components/adguard_home_extended/strings.json\\`\n- File: \\`custom_components/adguard_home_extended/translations/en.json\\`\n\n## Fix Required\n1. Compare both files\n2. Ensure \\`translations/en.json\\` contains all keys from \\`strings.json\\`\n3. Consider adding a CI check to verify synchronization","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T16:36:36.501172-05:00","updated_at":"2025-12-17T16:51:36.051228-05:00","closed_at":"2025-12-17T16:51:36.051228-05:00"}
{"id":"homeassistant_adguard_home-ijb","title":"Add Ecosia to SafeSearch model","description":"## Problem\nThe SafeSearchSettings model in api/models.py is missing Ecosia support, which was added in AdGuard Home v0.107.52.\n\n## Research\nPer AdGuard Home release notes (July 4, 2024 - v0.107.52):\n\u003e Added support for Ecosia search engine to Safe Search\n\nThe current SafeSearchSettings dataclass only includes: bing, duckduckgo, google, pixabay, yandex, youtube.\n\n## Fix Required\nAdd \\`ecosia: bool = True\\` field to SafeSearchSettings in api/models.py and update from_dict/to_dict methods.\n\n## Files Affected\n- custom_components/adguard_home_extended/api/models.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T18:38:37.152683-05:00","updated_at":"2025-12-17T18:44:07.024234-05:00","closed_at":"2025-12-17T18:44:07.024234-05:00"}
{"id":"homeassistant_adguard_home-iwx","title":"Update Stats model to match OpenAPI schema","description":"## Gap Identified\nThe Stats model in models.py is missing fields defined in the OpenAPI spec, particularly histogram/time-series data.\n\n## File Locations\n- **Models File**: \\`custom_components/adguard_home_extended/api/models.py\\`\n- **Model Class**: \\`AdGuardHomeStats\\` dataclass\n- **Test File**: \\`tests/test_models.py\\`\n- **API Client Usage**: \\`custom_components/adguard_home_extended/api/client.py\\` - \\`get_stats()\\` method\n\n## Current Model Fields\n- num_dns_queries\n- num_blocked_filtering\n- num_replaced_safebrowsing\n- num_replaced_parental\n- num_replaced_safesearch\n- avg_processing_time\n- top_queried_domains\n- top_blocked_domains\n- top_clients\n\n## Missing Fields (per OpenAPI)\n- \\`time_units\\` (string) - Time unit for stats ('hours' or 'days')\n- \\`dns_queries\\` (array of integers) - Histogram of DNS queries over time\n- \\`blocked_filtering\\` (array of integers) - Histogram of blocked queries\n- \\`replaced_safebrowsing\\` (array of integers) - Histogram\n- \\`replaced_safesearch\\` (array of integers) - Histogram\n- \\`replaced_parental\\` (array of integers) - Histogram\n\n## OpenAPI Schema Reference\n\\`\\`\\`yaml\nStats:\n  type: object\n  properties:\n    time_units:\n      type: string\n      enum: [hours, days]\n    num_dns_queries:\n      type: integer\n    num_blocked_filtering:\n      type: integer\n    dns_queries:\n      type: array\n      items:\n        type: integer\n      description: DNS queries histogram\n    blocked_filtering:\n      type: array\n      items:\n        type: integer\n    replaced_safebrowsing:\n      type: array\n      items:\n        type: integer\n    replaced_parental:\n      type: array\n      items:\n        type: integer\n    replaced_safesearch:\n      type: array\n      items:\n        type: integer\n\\`\\`\\`\n\n## Acceptance Criteria\n- [ ] Add \\`time_units: str | None = None\\` field\n- [ ] Add \\`dns_queries: list[int] = field(default_factory=list)\\` histogram field\n- [ ] Add \\`blocked_filtering: list[int] = field(default_factory=list)\\` histogram field\n- [ ] Add remaining histogram array fields\n- [ ] Update \\`from_dict()\\` parsing logic\n- [ ] Add tests in test_models.py with histogram data\n- [ ] Tests pass with \\`pytest tests/test_models.py -v\\`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:21:39.896212-05:00","updated_at":"2025-12-17T20:27:16.265162-05:00"}
{"id":"homeassistant_adguard_home-iyj","title":"Translations and strings","description":"Create strings.json and translations/en.json for all entities, services, config flow steps, and error messages","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T15:53:13.732271-05:00","updated_at":"2025-12-17T16:00:31.872535-05:00","closed_at":"2025-12-17T16:00:31.872535-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-iyj","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:39.056145-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-izj","title":"DNS rewrite management","description":"Create services and entities for DNS rewrite rules management: list rewrites, add rewrite, remove rewrite","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T15:53:00.440617-05:00","updated_at":"2025-12-17T16:26:16.42144-05:00","closed_at":"2025-12-17T16:26:16.42144-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-izj","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.944807-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-izj","depends_on_id":"homeassistant_adguard_home-5k9","type":"blocks","created_at":"2025-12-17T15:53:47.558682-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-jc0","title":"Fix empty API response handling for chunked transfers","description":"## Problem\nThe API client checks \\`response.content_length == 0\\` to detect empty responses, but \\`content_length\\` can be \\`None\\` for chunked transfer encoding responses. This could cause unexpected \\`ContentTypeError\\` when calling \\`.json()\\` on an empty response.\n\n## Location\n- File: \\`api/client.py\\` lines 112-115\n\n## Current Code\n\\`\\`\\`python\n# Some endpoints return empty body on success\nif response.content_length == 0:\n    return None\n\nreturn await response.json()\n\\`\\`\\`\n\n## Recommended Fix\n\\`\\`\\`python\n# Handle empty body gracefully\nif response.status == 204:  # No Content\n    return None\ntry:\n    return await response.json()\nexcept aiohttp.ContentTypeError:\n    return None  # Empty or non-JSON response\n\\`\\`\\`\n\n## Rationale\nHTTP chunked transfer encoding doesn't include a Content-Length header, so \\`content_length\\` will be \\`None\\`. The comparison \\`None == 0\\` is \\`False\\`, causing the code to attempt JSON parsing on potentially empty responses. Using status code 204 and exception handling is more robust.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T17:08:24.429002-05:00","updated_at":"2025-12-17T17:52:40.222141-05:00","closed_at":"2025-12-17T17:52:40.222141-05:00"}
{"id":"homeassistant_adguard_home-ko8","title":"Add protection pause duration support","description":"## Background\nAdGuard Home supports temporarily pausing protection with a duration parameter via \\`POST /control/protection\\`.\n\n## Current Implementation (client.py:152-154)\n\\`\\`\\`python\nasync def set_protection(self, enabled: bool) -\u003e None:\n    \"\"\"Enable or disable protection.\"\"\"\n    await self._post(API_PROTECTION, {\"enabled\": enabled})\n\\`\\`\\`\n\n## AdGuard Home API\n\\`\\`\\`json\nPOST /control/protection\n{\n  \"enabled\": false,\n  \"duration\": 3600000  // milliseconds - protection resumes after this time\n}\n\\`\\`\\`\n\n## Required Changes\n1. Update client method:\n\\`\\`\\`python\nasync def set_protection(self, enabled: bool, duration_ms: int | None = None) -\u003e None:\n    \"\"\"Enable or disable protection.\n    \n    Args:\n        enabled: Whether protection should be enabled\n        duration_ms: If disabling, auto-resume after this many milliseconds\n    \"\"\"\n    data = {\"enabled\": enabled}\n    if not enabled and duration_ms:\n        data[\"duration\"] = duration_ms\n    await self._post(API_PROTECTION, data)\n\\`\\`\\`\n\n2. Add service \\`pause_protection\\` with duration parameter\n3. Optionally add sensor showing time until protection resumes\n\n## Use Case\nUsers can temporarily disable protection for a set time (e.g., \"pause for 1 hour\") without forgetting to re-enable it.\n\n## Research Source\nAdGuard Home API docs: 'The new HTTP API POST /control/protection, that updates protection state and adds an optional pause duration'","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T18:17:16.169052-05:00","updated_at":"2025-12-17T18:31:20.459126-05:00","closed_at":"2025-12-17T18:31:20.459126-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-ko8","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:18:01.920115-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-ls5","title":"Verify and fix hacs.json icon path","description":"## Problem\nThe hacs.json references an icon at \\`custom_components/adguard_home_extended/icon.png\\` but HACS typically expects different path formats depending on version.\n\n## Location\n- File: \\`hacs.json\\` line 7\n\n## Current Code\n\\`\\`\\`json\n{\n  \"icon\": \"custom_components/adguard_home_extended/icon.png\"\n}\n\\`\\`\\`\n\n## Required Verification\n1. Verify icon.png exists at the specified path (confirmed: 469KB file exists)\n2. Check if HACS expects repo-root relative path or different format\n3. Test icon display in HACS UI\n\n## Potential Fixes\n- May need to use relative path from repo root without \\`custom_components/\\` prefix\n- Or reference a URL to a hosted icon\n- Or register with home-assistant/brands repository for official icons\n\n## Rationale\nHACS documentation indicates icon handling varies. If the path is wrong, users won't see the integration icon in the HACS UI, making the integration harder to identify.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T17:08:42.048852-05:00","updated_at":"2025-12-17T17:14:38.591769-05:00","closed_at":"2025-12-17T17:14:38.591769-05:00"}
{"id":"homeassistant_adguard_home-lyi","title":"December 2025 Integration Audit - HA 2025.12 \u0026 AGH v0.107.69 Compatibility","description":"Comprehensive audit of AdGuard Home Extended integration against latest Home Assistant (2025.12) and AdGuard Home (v0.107.69) releases. Findings from Perplexity research on Dec 17, 2025.\n\n## Target Versions\n- Home Assistant: 2025.12 (released Dec 3, 2025)\n- AdGuard Home: v0.107.69 (Oct 30, 2025)\n- HACS: 2.0+\n\n## Audit Scope\n1. Home Assistant best practices compliance (2024-2025 patterns)\n2. AdGuard Home API compatibility and deprecations\n3. HACS repository requirements\n4. Code quality and test coverage\n\n## Key Findings\n- Integration already compliant with config_entry pass to coordinator (2025.11 deprecation)\n- SafeSearch API uses deprecated endpoints that should migrate to settings API\n- Should migrate to entry.runtime_data pattern for typed auto-cleanup\n- Missing Home Assistant Brands submission for official icons\n- Overall: Excellent integration quality with minor improvements needed","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-17T20:39:34.516802-05:00","updated_at":"2025-12-17T20:39:34.516802-05:00"}
{"id":"homeassistant_adguard_home-m2g","title":"Config flow implementation","description":"Create config_flow.py with UI wizard for host, port, username, password, SSL verification. Include connection validation and reauthentication support","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-17T15:52:28.984226-05:00","updated_at":"2025-12-17T16:00:21.367977-05:00","closed_at":"2025-12-17T16:00:21.367977-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-m2g","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.676203-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-m2g","depends_on_id":"homeassistant_adguard_home-1bb","type":"blocks","created_at":"2025-12-17T15:53:47.278271-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-mcg","title":"Integration Audit: AdGuard Home Extended for HA 2025.12","description":"Epic tracking all improvements identified during the December 2025 integration audit.\n\n## Research Summary\n- **Home Assistant**: Latest is 2025.12.x (released Dec 2025) with new Labs features, intuitive triggers, and breaking changes\n- **AdGuard Home**: Latest stable is v0.107.65 (Aug 2025) with new cache_enabled field, new blocked services (ChatGPT, Claude, DeepSeek, Odysee)\n\n## Current Integration Status\n- Targets HA 2025.1.0 minimum\n- Supports AdGuard Home v0.107.56+ features\n- Architecture follows HA best practices (DataUpdateCoordinator, proper entity patterns)\n- Quality scale: Silver tier claimed\n\n## Key Findings\n1. Need to verify compatibility with HA 2025.12 breaking changes\n2. Several DNS configuration options not exposed as controls\n3. Upstream DNS server metrics available but not exposed\n4. Test coverage needs verification\n5. Device discovery (SSDP/MDNS) not implemented\n6. HACS config could add zip_release option","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-17T19:55:33.101114-05:00","updated_at":"2025-12-17T20:00:58.558928-05:00","closed_at":"2025-12-17T20:00:58.558928-05:00"}
{"id":"homeassistant_adguard_home-mia","title":"Add filter_lists.py entity tests","description":"## Coverage Gap\n\\`filter_lists.py\\` has 69% coverage (29 lines missing).\n\n## Missing Coverage\nLines 85, 99, 142-145, 150-153, 160, 164-201, 205-207\n\n### Key Untested Areas\n- Filter entity state updates\n- Filter enable/disable actions\n- Filter refresh operations\n\n## Test Cases Needed\n1. test_filter_entity_state\n2. test_filter_entity_attributes\n3. test_filter_enable_action\n4. test_filter_disable_action\n5. test_filter_refresh_action\n\n## Files to Modify\n- \\`tests/test_filter_lists.py\\`\n\n## Acceptance Criteria\n- [ ] Filter entity state methods tested\n- [ ] Enable/disable toggle tested\n- [ ] Refresh action tested","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:21:35.6883-05:00","updated_at":"2025-12-17T21:31:37.723073-05:00","closed_at":"2025-12-17T21:31:37.723073-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-mia","depends_on_id":"homeassistant_adguard_home-x5q","type":"blocks","created_at":"2025-12-17T21:22:14.910303-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-mk2","title":"Expand test coverage for edge cases","description":"## Problem\nTest coverage exists for core functionality but lacks edge case and integration testing.\n\n## Current Test Coverage\n✅ Switch state functions\n✅ Basic sensor value functions\n✅ Config flow happy path\n✅ Model parsing\n\n## Missing Test Coverage\n❌ Config flow reauth path\n❌ Service registration and execution\n❌ Dynamic client entity lifecycle (add/remove clients)\n❌ API error scenarios (timeouts, malformed responses)\n❌ Coordinator update failures and recovery\n❌ Options flow changes triggering reload\n\n## Research\nHome Assistant integration quality scale requires:\n- 80%+ code coverage for silver quality\n- Integration tests for config/options flows\n- Mock external API calls properly\n\n## Recommended Tests to Add\n1. \\`test_config_flow.py\\`: Add reauth flow tests\n2. \\`test_init.py\\`: Add service registration tests\n3. \\`test_switch.py\\`: Add client entity lifecycle tests\n4. \\`test_coordinator.py\\`: Add error recovery tests\n5. \\`test_api_client.py\\`: Add timeout/error response tests\n\n## Files Affected\n- tests/test_config_flow.py\n- tests/test_init.py\n- tests/test_coordinator.py\n- tests/test_api_client.py","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T19:09:53.12866-05:00","updated_at":"2025-12-17T19:50:03.578654-05:00","closed_at":"2025-12-17T19:50:03.578654-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-mk2","depends_on_id":"homeassistant_adguard_home-psj","type":"blocks","created_at":"2025-12-17T19:11:00.179861-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-mk2","depends_on_id":"homeassistant_adguard_home-o1r","type":"blocks","created_at":"2025-12-17T19:11:00.217545-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-mk2","depends_on_id":"homeassistant_adguard_home-bq0","type":"blocks","created_at":"2025-12-17T19:11:00.27818-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-n68","title":"Add __all__ exports to api/__init__.py","description":"## Problem\nThe \\`api/__init__.py\\` module doesn't define \\`__all__\\` to explicitly export the client classes, making imports less clean and IDE auto-imports less reliable.\n\n## Location\n- File: \\`api/__init__.py\\`\n\n## Current State\nThe file exists but may be empty or not export the key classes.\n\n## Recommended Fix\n\\`\\`\\`python\n\"\"\"AdGuard Home API client.\"\"\"\nfrom .client import (\n    AdGuardHomeClient,\n    AdGuardHomeError,\n    AdGuardHomeAuthError,\n    AdGuardHomeConnectionError,\n)\nfrom .models import (\n    AdGuardHomeStatus,\n    AdGuardHomeStats,\n    FilteringStatus,\n    AdGuardHomeClient as ClientConfig,\n    BlockedService,\n    DhcpStatus,\n    DnsRewrite,\n)\n\n__all__ = [\n    \"AdGuardHomeClient\",\n    \"AdGuardHomeError\",\n    \"AdGuardHomeAuthError\",\n    \"AdGuardHomeConnectionError\",\n    \"AdGuardHomeStatus\",\n    \"AdGuardHomeStats\",\n    \"FilteringStatus\",\n    \"ClientConfig\",\n    \"BlockedService\",\n    \"DhcpStatus\",\n    \"DnsRewrite\",\n]\n\\`\\`\\`\n\n## Rationale\nDefining \\`__all__\\` is a Python best practice for packages. It enables cleaner imports (\\`from .api import AdGuardHomeClient\\`), improves IDE support, and documents the public API explicitly.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T17:09:08.852227-05:00","updated_at":"2025-12-17T17:15:11.900451-05:00","closed_at":"2025-12-17T17:15:11.900451-05:00"}
{"id":"homeassistant_adguard_home-n7t","title":"Add blocked services schedule support","description":"## Problem\nThe integration supports setting blocked services but does not expose the schedule functionality, which allows time-based service blocking (a key parental control feature).\n\n## Research\nFrom AdGuard Home API CHANGELOG.md v0.107.56:\n\u003e New blocked services APIs with schedule support\n\nThe API accepts/returns format:\n\\`\\`\\`json\n{\n  \"schedule\": {\n    \"time_zone\": \"Local\",\n    \"sun\": {\n      \"start\": 46800000,\n      \"end\": 82800000\n    },\n    \"mon\": { \"start\": 0, \"end\": 86399999 }\n  },\n  \"ids\": [\"facebook\", \"youtube\"]\n}\n\\`\\`\\`\n\nTime values are milliseconds from midnight.\n\nThe API client has \\`get_blocked_services_with_schedule()\\` and \\`set_blocked_services(services, schedule)\\` methods, but:\n1. No entity exposes the schedule\n2. The set_blocked_services service doesn't accept schedule parameter\n\n## Fix Required\n1. Update set_blocked_services service to accept optional schedule parameter\n2. Consider adding a schedule entity or configuration UI\n3. Add schedule data to coordinator fetch\n\n## Dependencies\n- Should be done after: Add newer AdGuard Home API endpoints (homeassistant_adguard_home-66o)\n\n## Files Affected\n- custom_components/adguard_home_extended/__init__.py (service schema)\n- custom_components/adguard_home_extended/services.yaml\n- custom_components/adguard_home_extended/coordinator.py","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T18:39:52.5738-05:00","updated_at":"2025-12-17T19:02:03.787368-05:00","closed_at":"2025-12-17T19:02:03.787368-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-n7t","depends_on_id":"homeassistant_adguard_home-66o","type":"blocks","created_at":"2025-12-17T18:39:56.450318-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-ncl","title":"Update blocked_services API payload format for v0.107.37+","description":"## Problem\nThe \\`set_blocked_services\\` method sends a plain list to the API:\n\\`\\`\\`python\nawait self._post(API_BLOCKED_SERVICES_SET, services)\n\\`\\`\\`\n\nHowever, AdGuard Home v0.107.37+ changed the API to expect a different format with schedule support.\n\n## Research\nPer AdGuard Home changelog and API updates:\n- Old format (pre-0.107.37): \\`['service1', 'service2']\\`\n- New format (0.107.37+): \\`{'ids': ['service1', 'service2'], 'schedule': {...}}\\`\n- The old format may still work but could break in future versions\n\n## Location\n- File: \\`custom_components/adguard_home_extended/api/client.py\\` line 265\n\n## Fix Required\nUpdate to use the new format:\n\\`\\`\\`python\nasync def set_blocked_services(self, services: list[str]) -\u003e None:\n    await self._post(API_BLOCKED_SERVICES_SET, {\n        'ids': services,\n        'schedule': {'time_zone': 'Local'}  # or appropriate default\n    })\n\\`\\`\\`\n\nConsider also checking AdGuard Home version and using appropriate format.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T16:36:10.312576-05:00","updated_at":"2025-12-17T16:49:26.504238-05:00","closed_at":"2025-12-17T16:49:26.504238-05:00"}
{"id":"homeassistant_adguard_home-nj6","title":"Add DNS info fetch to coordinator","description":"## Problem\nThe DataUpdateCoordinator does not fetch DNS configuration info from the API, which is required for the DNS cache switch entity (and other DNS-related features).\n\n## Research\nAdGuard Home v0.107.65 (August 2025) added:\n- New \\`cache_enabled\\` field to HTTP API (GET /control/dns_info and POST /control/dns_config)\n- Separate checkbox in Web UI to enable/disable DNS response cache\n\nThe API client already has \\`get_dns_info()\\` and \\`set_dns_cache_enabled()\\` methods, but the coordinator doesn't use them.\n\n## Fix Required\n1. Add \\`dns_info: dict[str, Any] = {}\\` to AdGuardHomeData class\n2. Add DNS info fetch in _async_update_data():\n\\`\\`\\`python\ntry:\n    data.dns_info = await self.client.get_dns_info()\nexcept AdGuardHomeConnectionError as err:\n    _LOGGER.debug(\"Failed to fetch DNS info: %s\", err)\n\\`\\`\\`\n\n## Files Affected\n- custom_components/adguard_home_extended/coordinator.py","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T18:38:52.766796-05:00","updated_at":"2025-12-17T18:47:06.961896-05:00","closed_at":"2025-12-17T18:47:06.961896-05:00"}
{"id":"homeassistant_adguard_home-nrq","title":"Consider adding rate limit awareness","description":"## Feature Request\nAdd awareness of AdGuard Home's rate limiting to prevent API throttling.\n\n## Research\nAdGuard Home has a default rate limit of 20 requests per second (configurable via \\`rate_limit\\` in DNS config).\n\nThe integration currently:\n- Polls every 30 seconds (configurable)\n- Makes multiple API calls per poll cycle:\n  - /control/status\n  - /control/stats\n  - /control/filtering/status\n  - /control/dns_info\n  - /control/blocked_services/all + /list\n  - /control/clients\n  - /control/dhcp/status\n  - /control/rewrite/list\n  - /control/querylog\n\nThat's ~10 calls per update cycle, well within limits for default polling.\n\n## Potential Issues\n- Multiple HA instances hitting same AGH\n- Rapid service calls from automations\n- Aggressive scan intervals\n\n## Implementation Options\n1. Add request throttling/debouncing in API client\n2. Batch requests where possible\n3. Detect 429 responses and back off\n4. Surface rate limit in diagnostics\n\n## Priority\nLow - current implementation is well within limits for typical use.\n\n## Files Affected\n- custom_components/adguard_home_extended/api/client.py\n- custom_components/adguard_home_extended/diagnostics.py","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T19:10:20.920677-05:00","updated_at":"2025-12-17T19:50:18.646741-05:00","closed_at":"2025-12-17T19:50:18.646741-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-nrq","depends_on_id":"homeassistant_adguard_home-mk2","type":"blocks","created_at":"2025-12-17T19:11:03.757049-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-nux","title":"Add client UID field to AdGuardHomeClient model","description":"## Background\nSince AdGuard Home v0.107.46, persistent clients have a \\`uid\\` field that provides a stable unique identifier separate from the client name.\n\n## Current Model (models.py:99-128)\n\\`\\`\\`python\n@dataclass\nclass AdGuardHomeClient:\n    name: str\n    ids: list[str] = field(default_factory=list)\n    use_global_settings: bool = True\n    # ../.. other fields\n\\`\\`\\`\n\n## Missing Field\n\\`\\`\\`python\nuid: str = \"\"  # Unique identifier (v0.107.46+)\n\\`\\`\\`\n\n## Why It Matters\n- \\`name\\` can be changed by users\n- \\`uid\\` is immutable and guaranteed unique\n- Using \\`uid\\` for entity unique_id would survive client renames\n\n## Required Changes\n1. Add \\`uid\\` field to \\`AdGuardHomeClient\\` dataclass\n2. Update \\`from_dict()\\` to extract uid\n3. Consider using uid (when available) for entity identification\n\n## Research Source\nAdGuard Home CHANGELOG v0.107.46: 'The new property clients.persistent.*.uid, which is a unique identifier of the persistent client'","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T18:17:25.305189-05:00","updated_at":"2025-12-17T18:30:29.672364-05:00","closed_at":"2025-12-17T18:30:29.672364-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-nux","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:18:01.962882-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-o1r","title":"Implement check_host API with client/qtype filters","description":"## Feature Request\nAdd support for the enhanced check_host API endpoint that allows filtering by client and query type.\n\n## Research\nAdGuard Home v0.107.58 added:\n- \\`GET /control/check_host?name=\u003cdomain\u003e\u0026client=\u003cclient_id\u003e\u0026qtype=\u003cquery_type\u003e\\`\n- Allows checking which filtering rules apply for specific clients\n- Useful for debugging why certain domains are blocked/allowed\n\nFrom the API changelog:\n\u003e Added optional \\`client\\` and \\`qtype\\` URL query parameters to the \\`GET /control/check_host\\` HTTP API.\n\n## Use Cases\n- Debug filtering rules per-client\n- Test DNS blocking before applying\n- Service call to check if domain would be blocked\n\n## Implementation\n1. Add new API method \\`check_host(domain, client=None, qtype=None)\\`\n2. Create service \\`adguard_home_extended.check_host\\`\n3. Return filtering result as event or response\n\n## Files Affected\n- custom_components/adguard_home_extended/api/client.py\n- custom_components/adguard_home_extended/const.py\n- custom_components/adguard_home_extended/__init__.py\n- custom_components/adguard_home_extended/services.yaml","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T19:09:10.12905-05:00","updated_at":"2025-12-17T19:36:14.633748-05:00","closed_at":"2025-12-17T19:36:14.633748-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-o1r","depends_on_id":"homeassistant_adguard_home-xok","type":"blocks","created_at":"2025-12-17T19:10:46.62125-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-ob2","title":"Create epic: AdGuard Home API 2025 Compatibility","description":"## Overview\nEnsure the integration is fully compatible with AdGuard Home v0.107.69 (latest stable as of December 2025) and Home Assistant 2025.12.\n\n## Goals\n1. Update all data models to match current API\n2. Add support for new API endpoints and features\n3. Ensure HACS compatibility requirements are met\n4. Maintain silver quality scale compliance\n\n## Child Issues\n- homeassistant_adguard_home-ijb: Add Ecosia to SafeSearch model\n- homeassistant_adguard_home-95o: Add homeassistant minimum version\n- homeassistant_adguard_home-nj6: Add DNS info fetch to coordinator\n- homeassistant_adguard_home-00j: Add DNS cache switch entity\n- homeassistant_adguard_home-1z3: Complete service translations\n- homeassistant_adguard_home-8gd: Add icons to entity descriptions\n- homeassistant_adguard_home-66o: Add newer API endpoints\n- homeassistant_adguard_home-n7t: Add blocked services schedule\n- homeassistant_adguard_home-70o: Add async_remove_entry handler\n- homeassistant_adguard_home-9rw: Add DNS rewrite enable/disable\n- homeassistant_adguard_home-oez: Verify test coverage\n\n## Research Summary\n- AdGuard Home latest: v0.107.69 (October 30, 2025)\n- AdGuard Home beta: v0.108.0-b.75 \n- Home Assistant latest: 2025.12 (December 2025)\n- HACS 2.0 requirements apply","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-17T18:40:33.490997-05:00","updated_at":"2025-12-17T19:02:28.613578-05:00","closed_at":"2025-12-17T19:02:28.613578-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-ijb","type":"blocks","created_at":"2025-12-17T18:41:07.902806-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-95o","type":"blocks","created_at":"2025-12-17T18:41:07.941939-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-nj6","type":"blocks","created_at":"2025-12-17T18:41:07.976741-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-00j","type":"blocks","created_at":"2025-12-17T18:41:08.017529-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-1z3","type":"blocks","created_at":"2025-12-17T18:41:08.054262-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-8gd","type":"blocks","created_at":"2025-12-17T18:41:13.860115-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-66o","type":"blocks","created_at":"2025-12-17T18:41:13.900158-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-n7t","type":"blocks","created_at":"2025-12-17T18:41:13.937037-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-70o","type":"blocks","created_at":"2025-12-17T18:41:13.972244-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-9rw","type":"blocks","created_at":"2025-12-17T18:41:14.010103-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ob2","depends_on_id":"homeassistant_adguard_home-oez","type":"blocks","created_at":"2025-12-17T18:41:14.047764-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-oez","title":"Verify and improve test coverage","description":"## Problem\nThe integration claims quality_scale: silver in manifest.json, which requires adequate test coverage. Need to verify current coverage and identify gaps.\n\n## Research\nFor Home Assistant Silver quality scale:\n- Must have unit tests for config flow\n- Must have unit tests for coordinator error handling\n- Should test entity state changes\n- Should test service calls\n\nCurrent test files:\n- tests/test_api_client.py\n- tests/test_blocked_services.py\n- tests/test_client_entities.py\n- tests/test_config_flow.py\n- tests/test_coordinator.py\n- tests/test_diagnostics.py\n- tests/test_dns_rewrite.py\n- tests/test_init.py\n- tests/test_models.py\n- tests/test_sensor.py\n- tests/test_switch.py\n\n## Fix Required\n1. Run pytest with coverage to identify gaps\n2. Add tests for any uncovered code paths\n3. Ensure all new features have corresponding tests\n\n## Commands\n\\`\\`\\`bash\npytest --cov=custom_components.adguard_home_extended --cov-report=term-missing\n\\`\\`\\`\n\n## Files Affected\n- tests/*.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T18:40:22.679364-05:00","updated_at":"2025-12-17T18:55:14.076476-05:00","closed_at":"2025-12-17T18:55:14.076476-05:00"}
{"id":"homeassistant_adguard_home-ota","title":"Query log sensors","description":"Create sensors for query log data: recent queries, recent blocked queries, query log statistics","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T15:53:04.547317-05:00","updated_at":"2025-12-17T16:26:16.661712-05:00","closed_at":"2025-12-17T16:26:16.661712-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-ota","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.980854-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ota","depends_on_id":"homeassistant_adguard_home-5k9","type":"blocks","created_at":"2025-12-17T15:53:47.596117-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-pd1","title":"Verify and improve test coverage","description":"## Rationale\nThe integration claims Silver quality scale which requires good test coverage. Need to verify current coverage and identify gaps.\n\n### Existing Test Files\n- \\`test_api_client.py\\` - API client tests\n- \\`test_binary_sensor.py\\` - Binary sensor tests\n- \\`test_blocked_services.py\\` - Blocked services tests\n- \\`test_client_entities.py\\` - Per-client entity tests\n- \\`test_config_flow.py\\` - Config flow tests\n- \\`test_coordinator.py\\` - Coordinator tests\n- \\`test_diagnostics.py\\` - Diagnostics tests\n- \\`test_dns_rewrite.py\\` - DNS rewrite tests\n- \\`test_init.py\\` - Integration setup tests\n- \\`test_models.py\\` - Data model tests\n- \\`test_sensor.py\\` - Sensor tests\n- \\`test_switch.py\\` - Switch tests\n\n### Required Verification\n1. Run \\`pytest --cov\\` to measure actual coverage percentage\n2. Identify untested code paths\n3. Ensure edge cases are covered:\n   - API connection failures\n   - Authentication errors\n   - Malformed API responses\n   - Empty data scenarios\n   - Multi-instance scenarios\n\n### Silver Quality Scale Requirements\n- Integration must have tests\n- Tests should cover config flow\n- Tests should cover coordinator\n- Tests should mock external API calls\n\n### Action Items\n- [ ] Run coverage report\n- [ ] Add tests for any uncovered code paths\n- [ ] Ensure all error scenarios are tested\n- [ ] Verify mock fixtures are complete","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:56:16.261284-05:00","updated_at":"2025-12-17T20:23:18.503039-05:00","closed_at":"2025-12-17T20:23:18.503039-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-pd1","depends_on_id":"homeassistant_adguard_home-mcg","type":"blocks","created_at":"2025-12-17T19:57:24.381292-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-pd1","depends_on_id":"homeassistant_adguard_home-5ji","type":"blocks","created_at":"2025-12-17T19:57:35.051466-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-ply","title":"Blocked services switches","description":"Create switches to toggle blocking of specific services: social media (TikTok, Instagram, etc.), streaming (Netflix, YouTube), AI services (ChatGPT, Claude)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:52:46.739378-05:00","updated_at":"2025-12-17T16:02:25.526722-05:00","closed_at":"2025-12-17T16:02:25.526722-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-ply","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.829094-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-ply","depends_on_id":"homeassistant_adguard_home-5k9","type":"blocks","created_at":"2025-12-17T15:53:47.437339-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-psj","title":"Add DNS rewrite enable/disable switch entities","description":"## Feature Request\nCreate individual switch entities for each DNS rewrite rule to enable/disable them.\n\n## Research\nAdGuard Home v0.107.68 added:\n- \\`enabled\\` field to DNS rewrite rules\n- Ability to toggle rules via \\`PUT /control/rewrite/update\\`\n\nFrom release notes:\n\u003e New option to enable and disable DNS rewrite rules 🚦\n\n## Current State\n- Model already has \\`enabled: bool = True\\` field in DnsRewrite dataclass\n- API client has \\`set_rewrite_enabled()\\` method\n- No entities expose this functionality\n\n## Benefits\n- Toggle rewrites without deleting them\n- Automation support for conditional DNS rewrites\n- Better visibility of rewrite state in HA\n\n## Implementation\n1. Create \\`AdGuardDnsRewriteSwitch\\` entity class\n2. Dynamic entity creation similar to client entities\n3. Use domain+answer as unique identifier\n\n## Files Affected\n- custom_components/adguard_home_extended/switch.py (or new dns_rewrite.py)\n- custom_components/adguard_home_extended/coordinator.py","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T19:09:43.524458-05:00","updated_at":"2025-12-17T19:41:40.012993-05:00","closed_at":"2025-12-17T19:41:40.012993-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-psj","depends_on_id":"homeassistant_adguard_home-xok","type":"blocks","created_at":"2025-12-17T19:10:54.436911-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-qla","title":"Add API version detection for feature compatibility","description":"## Rationale\nAdGuard Home APIs have evolved over versions with new endpoints and features. Currently the integration uses try/except to handle missing features, but explicit version detection would be cleaner.\n\n### Version-Specific Features\n| Feature | Minimum Version |\n|---------|----------------|\n| Base API | v0.100+ |\n| Stats/QueryLog config | v0.107.30+ |\n| Client UID field | v0.107.46+ |\n| Ecosia safe search | v0.107.52+ |\n| Blocked services schedules | v0.107.56+ |\n| Client search API | v0.107.56+ |\n| check_host client/qtype params | v0.107.58+ |\n| cache_enabled field | v0.107.65+ |\n| DNS rewrite enabled field | v0.107.68+ |\n| ChatGPT/Claude/DeepSeek services | v0.107.66+ |\n\n### Implementation Approach\n1. Parse version from \\`GET /control/status\\` response\n2. Store in coordinator: \\`self._adguard_version = data.status.version\\`\n3. Create helper method: \\`def supports_feature(feature: str) -\u003e bool\\`\n4. Use for:\n   - Conditional entity creation\n   - Service availability\n   - Diagnostic information\n   - Better error messages\n\n### Benefits\n- Cleaner code (no try/except for version features)\n- Better user feedback ('Feature X requires AdGuard Home v0.107.56+')\n- Easier maintenance as new versions release\n\n### Version Parsing\nVersion string format: \\`v0.107.65\\` or \\`0.107.65\\`\n\\`\\`\\`python\nfrom packaging import version\nadg_version = version.parse(status.version.lstrip('v'))\nif adg_version \u003e= version.parse('0.107.65'):\n    # Use cache_enabled\n\\`\\`\\`","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-17T19:57:09.215594-05:00","updated_at":"2025-12-17T20:03:17.425133-05:00","closed_at":"2025-12-17T20:03:17.425133-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-qla","depends_on_id":"homeassistant_adguard_home-mcg","type":"blocks","created_at":"2025-12-17T19:57:24.564872-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-qzw","title":"Add Upstream DNS Server Metrics Sensors","description":"## Rationale\nAdGuard Home v0.107.59+ provides metrics showing response counts and average processing time per upstream DNS server. This data is valuable for:\n- Monitoring upstream server health\n- Identifying slow/unreliable upstreams\n- Optimizing DNS resolution performance\n\n### Available Metrics (per upstream)\n- Total responses count\n- Average processing time (ms)\n- Upstream server address\n\n### Implementation Approach\n1. Fetch upstream metrics from stats API\n2. Create sensor entities per upstream server:\n   - \\`sensor.adguard_upstream_{name}_responses\\` (total_increasing)\n   - \\`sensor.adguard_upstream_{name}_avg_time\\` (measurement, ms)\n3. Use dynamic entity creation pattern (like client entities)\n4. Handle upstream changes gracefully (servers added/removed)\n\n### API Reference\n- Endpoint: \\`GET /control/stats\\` includes upstream data\n- Available since: AdGuard Home v0.107.59+\n- Fields: \\`top_upstreams_responses\\`, \\`top_upstreams_avg_time\\`\n\n### Considerations\n- May add significant entity count if many upstreams configured\n- Consider making this opt-in via options flow\n- Need to handle DNS upstream format parsing (e.g., \\`https://dns.google/dns-query\\`)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T19:56:06.260416-05:00","updated_at":"2025-12-17T20:08:32.097205-05:00","closed_at":"2025-12-17T20:08:32.097205-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-qzw","depends_on_id":"homeassistant_adguard_home-mcg","type":"blocks","created_at":"2025-12-17T19:57:24.34204-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-qzw","depends_on_id":"homeassistant_adguard_home-qla","type":"blocks","created_at":"2025-12-17T19:57:30.536121-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-rjb","title":"Update FilteringStatus model to match OpenAPI schema","description":"## Gap Identified\nThe FilteringStatus model is missing detailed filter properties from the OpenAPI spec.\n\n## File Locations\n- **Models File**: \\`custom_components/adguard_home_extended/api/models.py\\`\n- **Model Class**: \\`FilteringStatus\\` dataclass and nested \\`Filter\\` if exists\n- **Test File**: \\`tests/test_models.py\\` and \\`tests/test_filter_lists.py\\`\n- **API Client Usage**: \\`custom_components/adguard_home_extended/api/client.py\\` - \\`get_filtering_status()\\` method\n\n## Current Model Structure\n- enabled\n- filters (list with basic info)\n- user_rules\n- interval\n\n## Missing Filter Object Fields (per OpenAPI)\nEach filter in the filters array should have:\n- \\`id\\` (integer) - Unique filter ID\n- \\`url\\` (string) - Filter list URL\n- \\`name\\` (string) - Filter name\n- \\`enabled\\` (boolean) - Whether filter is active\n- \\`last_updated\\` (string, datetime) - Last update timestamp\n- \\`rules_count\\` (integer) - Number of rules in filter\n  \n## Missing Top-Level Fields\n- \\`whitelist_filters\\` (array) - Separate whitelist filter array\n\n## OpenAPI Schema Reference\n\\`\\`\\`yaml\nFilterStatus:\n  type: object\n  properties:\n    enabled:\n      type: boolean\n    interval:\n      type: integer\n    filters:\n      type: array\n      items:\n        \\ref: '#/components/schemas/Filter'\n    whitelist_filters:\n      type: array\n      items:\n        \\ref: '#/components/schemas/Filter'\n    user_rules:\n      type: array\n      items:\n        type: string\n\nFilter:\n  type: object\n  properties:\n    id:\n      type: integer\n    url:\n      type: string\n    name:\n      type: string\n    enabled:\n      type: boolean\n    last_updated:\n      type: string\n      format: date-time\n    rules_count:\n      type: integer\n\\`\\`\\`\n\n## Acceptance Criteria\n- [ ] Create or update \\`Filter\\` dataclass with all fields (id, url, name, enabled, last_updated, rules_count)\n- [ ] Add \\`whitelist_filters: list[Filter] = field(default_factory=list)\\` to FilteringStatus\n- [ ] Ensure proper datetime parsing for \\`last_updated\\` field\n- [ ] Update \\`from_dict()\\` parsing logic\n- [ ] Add tests for filter list parsing with all fields\n- [ ] Tests pass with \\`pytest tests/test_models.py tests/test_filter_lists.py -v\\`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:23:04.327297-05:00","updated_at":"2025-12-17T20:27:53.435263-05:00"}
{"id":"homeassistant_adguard_home-t08","title":"Add explicit API request timeouts","description":"## Problem\nThe API client in \\`api/client.py\\` does not specify explicit timeouts for HTTP requests, relying on aiohttp defaults. This can cause hanging requests if AdGuard Home becomes unresponsive.\n\n## Research Findings (Dec 17, 2025)\n- AdGuard Home API endpoints are REST-based with JSON responses\n- Network latency and server load can cause slow responses\n- Home Assistant best practices recommend explicit timeouts to prevent blocking\n- The coordinator already has an update interval but individual API calls could hang indefinitely\n\n## Implementation\nAdd a \\`ClientTimeout\\` configuration to the API client:\n\n\\`\\`\\`python\nfrom aiohttp import ClientTimeout\n\nDEFAULT_TIMEOUT = ClientTimeout(total=30)\n\nasync def _request(self, method, endpoint, data=None):\n    async with self._session.request(\n        method,\n        url,\n        json=data,\n        headers=headers,\n        timeout=DEFAULT_TIMEOUT,  # Add explicit timeout\n    ) as response:\n\\`\\`\\`\n\n## Files to Modify\n- \\`custom_components/adguard_home_extended/api/client.py\\`\n- \\`tests/test_api_client.py\\` - Add timeout tests\n\n## Acceptance Criteria\n- [ ] All API requests have explicit 30-second timeout\n- [ ] Timeout errors are caught and converted to \\`AdGuardHomeConnectionError\\`\n- [ ] Tests verify timeout behavior","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T21:09:47.237537-05:00","updated_at":"2025-12-17T21:12:57.604509-05:00","closed_at":"2025-12-17T21:12:57.604509-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-t08","depends_on_id":"homeassistant_adguard_home-a43","type":"blocks","created_at":"2025-12-17T21:10:26.612374-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-t4k","title":"Add DNS rewrite update API endpoint","description":"## Background\nAdGuard Home v0.107.36 added \\`PUT /control/rewrite/update\\` for editing existing DNS rewrites in place, instead of requiring delete + re-add.\n\n## Current State\nThe integration only supports:\n- \\`add_rewrite(domain, answer)\\` via \\`POST /control/rewrite/add\\`\n- \\`delete_rewrite(domain, answer)\\` via \\`POST /control/rewrite/delete\\`\n\nMissing the update capability.\n\n## Required Changes\n1. Add constant to \\`const.py\\`:\n\\`\\`\\`python\nAPI_REWRITE_UPDATE: Final = \"/control/rewrite/update\"\n\\`\\`\\`\n\n2. Add client method:\n\\`\\`\\`python\nasync def update_rewrite(\n    self, \n    old_domain: str, \n    old_answer: str,\n    new_domain: str,\n    new_answer: str\n) -\u003e None:\n    \"\"\"Update an existing DNS rewrite.\"\"\"\n    await self._put(API_REWRITE_UPDATE, {\n        \"target\": {\"domain\": old_domain, \"answer\": old_answer},\n        \"update\": {\"domain\": new_domain, \"answer\": new_answer}\n    })\n\\`\\`\\`\n\n3. Add \\`update_dns_rewrite\\` service\n\n## Research Source\nAdGuard Home CHANGELOG: 'The ability to edit rewrite rules via PUT /control/rewrite/update HTTP API and the Web UI (#1577)'","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T18:16:37.721131-05:00","updated_at":"2025-12-17T18:29:37.067561-05:00","closed_at":"2025-12-17T18:29:37.067561-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-t4k","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:17:57.210115-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-tsi","title":"Add missing filter list management API tests","description":"## Gap Identified\nThe following filter management methods in client.py lack unit tests:\n- \\`add_filter_url()\\` - POST /control/filtering/add_url\n- \\`update_filter_url()\\` - POST /control/filtering/set_url (enable/disable/update)\n- \\`delete_filter_url()\\` - POST /control/filtering/remove_url\n- \\`refresh_filters()\\` - POST /control/filtering/refresh\n\n## File Locations\n- **API Client**: \\`custom_components/adguard_home_extended/api/client.py\\`\n- **Test File**: \\`tests/test_api_client.py\\` and \\`tests/test_filter_lists.py\\`\n- **Models**: \\`custom_components/adguard_home_extended/api/models.py\\` (FilteringStatus, Filter dataclasses)\n- **Existing test pattern**: See \\`test_get_filtering_status_success\\` in test_api_client.py\n\n## OpenAPI Reference\n\\`\\`\\`yaml\n/control/filtering/add_url:\n  post:\n    summary: Add filter URL\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/AddUrlRequest'\n\n/control/filtering/remove_url:\n  post:\n    summary: Remove filter URL\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/RemoveUrlRequest'\n\n/control/filtering/refresh:\n  post:\n    summary: Reload filtering rules from URLs\n    requestBody:\n      content:\n        application/json:\n          schema:\n            \\ref: '#/components/schemas/FilterRefreshRequest'\n\\`\\`\\`\n\n## Test Cases Needed\n1. test_add_filter_url_success\n2. test_add_filter_url_invalid_url\n3. test_add_filter_url_duplicate\n4. test_update_filter_url_enable_disable\n5. test_delete_filter_url_success\n6. test_delete_filter_url_not_found\n7. test_refresh_filters_success\n8. test_refresh_filters_with_whitelist_flag\n\n## Acceptance Criteria\n- [ ] All filter CRUD operations tested\n- [ ] Whitelist vs blocklist handling verified\n- [ ] URL validation edge cases covered\n- [ ] Tests pass with \\`pytest tests/test_api_client.py tests/test_filter_lists.py -v\\`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:21:14.812025-05:00","updated_at":"2025-12-17T20:26:44.77788-05:00"}
{"id":"homeassistant_adguard_home-tue","title":"Add async_migrate_entry for future config version changes","description":"## Problem\nThe config flow has \\`VERSION = 1\\` but no \\`async_migrate_entry\\` function is defined. When the config schema changes in the future, there will be no migration path for existing users.\n\n## Location\n- File: \\`config_flow.py\\` line 50\n\n## Current Code\n\\`\\`\\`python\nclass AdGuardHomeConfigFlow(ConfigFlow, domain=DOMAIN):\n    VERSION = 1\n    # No async_migrate_entry defined\n\\`\\`\\`\n\n## Recommended Enhancement\nAdd a placeholder migration function in \\`__init__.py\\`:\n\\`\\`\\`python\nasync def async_migrate_entry(hass: HomeAssistant, config_entry: ConfigEntry) -\u003e bool:\n    \"\"\"Migrate old entry.\"\"\"\n    _LOGGER.debug(\"Migrating from version %s\", config_entry.version)\n\n    if config_entry.version == 1:\n        # Future: migrate v1 -\u003e v2\n        pass\n\n    return True\n\\`\\`\\`\n\n## Rationale\nHome Assistant calls \\`async_migrate_entry\\` when loading a config entry with a version lower than the current \\`VERSION\\`. Having the scaffolding in place makes future migrations easier and prevents the integration from failing to load when schema changes are introduced.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T17:09:18.009814-05:00","updated_at":"2025-12-17T18:12:04.659286-05:00","closed_at":"2025-12-17T18:12:04.659286-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-tue","depends_on_id":"homeassistant_adguard_home-8uk","type":"blocks","created_at":"2025-12-17T17:09:39.179586-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-ufp","title":"Implement DNS configuration API endpoints","description":"## Gap Identified\nFull DNS server configuration endpoints exist in the OpenAPI spec but are not fully implemented.\n\n## Missing/Incomplete Endpoints\n- GET /control/dns_info - Partially implemented, missing fields\n- POST /control/dns_config - Update DNS server settings\n\n## Missing DnsInfo Fields (per OpenAPI)\n- \\`upstream_dns_file\\` (string)\n- \\`bootstrap_dns\\` (array) - Bootstrap DNS servers\n- \\`fallback_dns\\` (array) - Fallback DNS servers\n- \\`all_servers\\` (boolean) - Query all upstreams\n- \\`fastest_addr\\` (boolean) - Use fastest address\n- \\`cache_size\\` (integer) - DNS cache size in bytes\n- \\`cache_ttl_min\\` (integer) - Minimum TTL override\n- \\`cache_ttl_max\\` (integer) - Maximum TTL override\n- \\`cache_optimistic\\` (boolean) - Optimistic caching\n- \\`resolve_clients\\` (boolean) - Resolve client hostnames\n- \\`local_ptr_upstreams\\` (array) - PTR query upstreams\n\n## OpenAPI Schema Reference\n\\`\\`\\`yaml\nDNSConfig:\n  type: object\n  properties:\n    upstream_dns:\n      type: array\n      items:\n        type: string\n    upstream_dns_file:\n      type: string\n    bootstrap_dns:\n      type: array\n      items:\n        type: string\n    cache_size:\n      type: integer\n    cache_ttl_min:\n      type: integer\n    cache_ttl_max:\n      type: integer\n    # ../.. more fields\n\\`\\`\\`\n\n## Value for HA Integration\n- Sensors for cache size, TTL settings\n- Services to update upstream DNS servers\n- Useful for dynamic DNS configuration based on network state\n\n## Acceptance Criteria\n- [ ] Update DnsInfo model with all fields\n- [ ] Implement set_dns_config() method\n- [ ] Add unit tests for all new fields","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-17T20:22:28.744368-05:00","updated_at":"2025-12-17T20:22:28.744368-05:00"}
{"id":"homeassistant_adguard_home-v5q","title":"Implement query log configuration API","description":"## Gap Identified\nQuery log configuration endpoints exist but are not fully implemented.\n\n## Missing Endpoints\n- GET /control/querylog/config - Get query log settings\n- PUT /control/querylog/config/update - Update query log settings\n- POST /control/querylog/clear - Clear query log\n\n## OpenAPI Schema Reference\n\\`\\`\\`yaml\n/control/querylog/config:\n  get:\n    summary: Get query log configuration\n    responses:\n      200:\n        content:\n          application/json:\n            schema:\n              \\ref: '#/components/schemas/QueryLogConfig'\n\nQueryLogConfig:\n  type: object\n  properties:\n    enabled:\n      type: boolean\n    interval:\n      type: number\n      description: Log retention in hours (1, 24, 168 (week), 720 (month), 2160 (90 days))\n    anonymize_client_ip:\n      type: boolean\n    ignored:\n      type: array\n      items:\n        type: string\n      description: List of hosts to ignore\n\\`\\`\\`\n\n## Value for HA Integration\n- Switch to enable/disable query logging\n- Sensor for retention period\n- Service to clear query log\n- Privacy controls for client IP anonymization\n\n## Acceptance Criteria\n- [ ] Create QueryLogConfig model\n- [ ] Implement get_querylog_config() method\n- [ ] Implement set_querylog_config() method  \n- [ ] Implement clear_querylog() method\n- [ ] Add unit tests","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-17T20:22:36.760093-05:00","updated_at":"2025-12-17T20:22:36.760093-05:00"}
{"id":"homeassistant_adguard_home-vjo","title":"Fix device_info return type to use DeviceInfo dataclass","description":"## Problem\nIn \\`coordinator.py\\`, the \\`device_info\\` property returns a plain dict, but Home Assistant best practice (and type hints) expect \\`DeviceInfo\\` from \\`homeassistant.helpers.device_registry\\`.\n\n## Current Code (coordinator.py:152-165)\n\\`\\`\\`python\n@property\ndef device_info(self) -\u003e dict[str, Any]:\n    return {\n        \"identifiers\": {(DOMAIN, self.config_entry.entry_id)},\n        \"name\": f\"AdGuard Home ({self.config_entry.data.get('host', 'unknown')})\",\n        ../..\n    }\n\\`\\`\\`\n\n## Required Fix\n\\`\\`\\`python\nfrom homeassistant.helpers.device_registry import DeviceInfo\n\n@property\ndef device_info(self) -\u003e DeviceInfo:\n    return DeviceInfo(\n        identifiers={(DOMAIN, self.config_entry.entry_id)},\n        name=f\"AdGuard Home ({self.config_entry.data.get('host', 'unknown')})\",\n        manufacturer=\"AdGuard\",\n        model=\"AdGuard Home\",\n        sw_version=version,\n    )\n\\`\\`\\`\n\n## Research Source\nHome Assistant Developer Docs - DeviceInfo is the proper type for device registry integration. Using the dataclass ensures proper validation and future compatibility.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-17T18:15:49.158178-05:00","updated_at":"2025-12-17T18:21:48.42478-05:00","closed_at":"2025-12-17T18:21:48.42478-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-vjo","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:17:47.655245-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-vrs","title":"Add MINOR_VERSION to config flow for migration tracking","description":"## Background\nHome Assistant config entries support both \\`VERSION\\` and \\`MINOR_VERSION\\` for schema migrations.\n\n## Current Code (config_flow.py:54)\n\\`\\`\\`python\nclass AdGuardHomeConfigFlow(ConfigFlow, domain=DOMAIN):\n    VERSION = 1\n\\`\\`\\`\n\n## Recommended Change\n\\`\\`\\`python\nclass AdGuardHomeConfigFlow(ConfigFlow, domain=DOMAIN):\n    VERSION = 1\n    MINOR_VERSION = 1\n\\`\\`\\`\n\n## Rationale\n- \\`VERSION\\` changes require migration code in \\`async_migrate_entry()\\`\n- \\`MINOR_VERSION\\` allows tracking smaller schema changes without full migration\n- Provides better upgrade path documentation for users\n\n## Research Source\nHome Assistant Developer Docs - Config Flow: 'The schema version of the entries that it creates. Home Assistant will call your migrate method if the version changes'","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T18:17:06.418519-05:00","updated_at":"2025-12-17T18:24:05.436809-05:00","closed_at":"2025-12-17T18:24:05.436809-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-vrs","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:17:57.327856-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-wa7","title":"Update Client model to match OpenAPI schema","description":"## Gap Identified\nThe Client model in models.py is missing fields and has structural differences from the OpenAPI spec.\n\n## File Locations\n- **Models File**: \\`custom_components/adguard_home_extended/api/models.py\\`\n- **Model Class**: \\`AdGuardHomeClient\\` dataclass\n- **Test File**: \\`tests/test_models.py\\` and \\`tests/test_client_entities.py\\`\n- **API Client Usage**: \\`custom_components/adguard_home_extended/api/client.py\\` - \\`get_clients()\\`, \\`add_client()\\`, etc.\n\n## Current Model Fields\n- name\n- ids\n- use_global_settings\n- use_global_blocked_services\n- blocked_services\n- upstreams\n- tags\n- filtering_enabled\n- parental_enabled\n- safebrowsing_enabled\n- safesearch_enabled\n\n## Missing Fields (per OpenAPI)\n- \\`uid\\` (string) - Unique identifier (read-only, assigned by server)\n- \\`safe_search\\` (object) - Structured safe search settings per service:\n  - \\`enabled\\` (boolean)\n  - \\`bing\\`, \\`duckduckgo\\`, \\`google\\`, \\`pixabay\\`, \\`yandex\\`, \\`youtube\\` (boolean each)\n- \\`ignore_querylog\\` (boolean) - Exclude from query log\n- \\`ignore_statistics\\` (boolean) - Exclude from statistics\n- \\`blocked_services_pause_schedule\\` (object) - Schedule for service blocking\n\n## OpenAPI Schema Reference\n\\`\\`\\`yaml\nClient:\n  type: object\n  properties:\n    name:\n      type: string\n    ids:\n      type: array\n      items:\n        type: string\n    uid:\n      type: string\n      readOnly: true\n    safe_search:\n      \\ref: '#/components/schemas/SafeSearchConfig'\n    blocked_services_pause_schedule:\n      \\ref: '#/components/schemas/Schedule'\n    ignore_querylog:\n      type: boolean\n    ignore_statistics:\n      type: boolean\n\nSafeSearchConfig:\n  type: object\n  properties:\n    enabled:\n      type: boolean\n    bing:\n      type: boolean\n    duckduckgo:\n      type: boolean\n    google:\n      type: boolean\n    pixabay:\n      type: boolean\n    yandex:\n      type: boolean\n    youtube:\n      type: boolean\n\\`\\`\\`\n\n## Acceptance Criteria\n- [ ] Add \\`uid: str | None = None\\` field (read-only from API)\n- [ ] Create \\`SafeSearchConfig\\` dataclass if not exists\n- [ ] Replace \\`safesearch_enabled: bool\\` with \\`safe_search: SafeSearchConfig | None\\`\n- [ ] Add \\`ignore_querylog: bool = False\\` field\n- [ ] Add \\`ignore_statistics: bool = False\\` field\n- [ ] Update \\`from_dict()\\` and \\`to_dict()\\` methods\n- [ ] Update tests in test_models.py\n- [ ] Tests pass with \\`pytest tests/test_models.py tests/test_client_entities.py -v\\`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:21:49.661615-05:00","updated_at":"2025-12-17T20:27:28.60761-05:00"}
{"id":"homeassistant_adguard_home-x5q","title":"100% Test Coverage Epic","description":"## Goal\nAchieve 100% test coverage for HACS Silver badge eligibility.\n\n## Current Status\n- **Overall Coverage**: 80% (303 lines missing out of 1550)\n- **Tests Passing**: 377\n\n## Coverage Gaps by File (Priority Order)\n\n| File | Coverage | Missing Lines | Priority |\n|------|----------|---------------|----------|\n| __init__.py | 40% | 117 | HIGH - Services \u0026 setup |\n| switch.py | 67% | 57 | HIGH - Entity actions |\n| filter_lists.py | 69% | 29 | MEDIUM - Entity actions |\n| sensor.py | 65% | 14 | MEDIUM - State methods |\n| client_entities.py | 81% | 30 | MEDIUM - Toggle methods |\n| api/client.py | 87% | 30 | LOW - Edge cases |\n| blocked_services.py | 83% | 12 | LOW - Edge cases |\n\n## Already at 100%\n- api/models.py ✅\n- api/__init__.py ✅\n- const.py ✅\n\n## Near 100% (Quick Wins)\n- binary_sensor.py (97%) - 1 line\n- config_flow.py (96%) - 4 lines\n- coordinator.py (95%) - 6 lines\n- diagnostics.py (97%) - 1 line\n- version.py (98%) - 2 lines","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-17T21:21:07.805659-05:00","updated_at":"2025-12-17T21:21:07.805659-05:00"}
{"id":"homeassistant_adguard_home-xdm","title":"Fix multi-instance service registration","description":"## Problem\nServices are registered globally with \\`if not hass.services.has_service(...)\\` guard, but the service handlers capture the \\`coordinator\\` from whichever config entry is set up first. With multiple AdGuard Home instances, ALL service calls go to the first instance regardless of user intent.\n\n## Research\n- Home Assistant best practice: services should either use entity targets or look up the correct coordinator\n- The current pattern breaks for any user with 2+ AdGuard Home servers\n- Official integrations use device/entity targeting for multi-instance support\n\n## Location\n- File: \\`custom_components/adguard_home_extended/__init__.py\\` lines 85 and 161-244\n\n## Fix Required\nOption A (Recommended): Refactor services to accept a \\`device_id\\` or \\`entry_id\\` parameter and look up the correct coordinator:\n\\`\\`\\`python\nasync def handle_set_blocked_services(call: ServiceCall) -\u003e None:\n    # Look up coordinator from hass.data based on target\n    entry_id = call.data.get('entry_id')\n    if entry_id and entry_id in hass.data[DOMAIN]:\n        coordinator = hass.data[DOMAIN][entry_id]\n    elif len(hass.data[DOMAIN]) == 1:\n        coordinator = next(iter(hass.data[DOMAIN].values()))\n    else:\n        raise ServiceValidationError('Must specify entry_id with multiple instances')\n    # ../.. rest of handler\n\\`\\`\\`\n\nOption B: Convert to entity services that automatically target the correct device.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T16:35:10.221737-05:00","updated_at":"2025-12-17T16:46:54.335977-05:00","closed_at":"2025-12-17T16:46:54.335977-05:00"}
{"id":"homeassistant_adguard_home-xnt","title":"Add quick wins tests (97-98% files)","description":"## Coverage Gap\nSeveral files are 97-98% and need just a few tests to reach 100%.\n\n## Files and Missing Lines\n\n### binary_sensor.py (97% - 1 line)\n- Line 21: Need to test one more branch\n\n### config_flow.py (96% - 4 lines)\n- Line 42, 208-210: Discovery flow edge cases\n\n### coordinator.py (95% - 6 lines)\n- Lines 39, 203-204, 210-211, 229: Error handling paths\n\n### diagnostics.py (97% - 1 line)\n- Line 14: TYPE_CHECKING import\n\n### version.py (98% - 2 lines)\n- Lines 69, 95: Edge cases in version comparison\n\n### blocked_services.py (83% - 12 lines)\n- Lines 16, 141-160, 211, 235, 246: Schedule parsing edge cases\n\n## Files to Modify\n- \\`tests/test_binary_sensor.py\\`\n- \\`tests/test_config_flow.py\\`\n- \\`tests/test_coordinator.py\\`\n- \\`tests/test_diagnostics.py\\`\n- \\`tests/test_version.py\\`\n- \\`tests/test_blocked_services.py\\`\n\n## Acceptance Criteria\n- [ ] All 6 files reach 100% coverage\n- [ ] Edge cases and error paths tested","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T21:22:08.849256-05:00","updated_at":"2025-12-17T21:55:08.144706-05:00","closed_at":"2025-12-17T21:55:08.144706-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-xnt","depends_on_id":"homeassistant_adguard_home-x5q","type":"blocks","created_at":"2025-12-17T21:22:15.100841-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-xok","title":"Add API version documentation to constants","description":"## Problem\nThe const.py file defines API endpoints but doesn't document which AdGuard Home version introduced each endpoint.\n\n## Research\nAdGuard Home has evolved significantly:\n- v0.107.30: Added stats/config and querylog/config APIs\n- v0.107.56: Added blocked_services/get, blocked_services/update, clients/search APIs\n- v0.107.65: Added cache_enabled field to DNS config\n- v0.107.68: Added enabled field to DNS rewrite rules\n\n## Impact\n- Developers don't know which AGH version is required for features\n- Hard to maintain compatibility matrix\n- Debugging version-related issues is difficult\n\n## Solution\nAdd version comments to const.py:\n\\`\\`\\`python\n# v0.107.30+ Stats and Query Log Config APIs\nAPI_STATS_CONFIG: Final = \"/control/stats/config\"\n\n# v0.107.56+ Blocked Services with Schedule and Client Search\nAPI_BLOCKED_SERVICES_GET: Final = \"/control/blocked_services/get\"\n\\`\\`\\`\n\n## Files Affected\n- custom_components/adguard_home_extended/const.py","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T19:09:00.683358-05:00","updated_at":"2025-12-17T19:31:50.314823-05:00","closed_at":"2025-12-17T19:31:50.314823-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-xok","depends_on_id":"homeassistant_adguard_home-9l6","type":"blocks","created_at":"2025-12-17T19:10:34.568625-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-xok","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T19:11:08.898201-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-xuu","title":"Add DNS Configuration Control Switches","description":"## Rationale\nThe AdGuard Home API exposes several DNS configuration options via \\`/control/dns_config\\` that are not currently exposed in the integration. Users would benefit from controlling these settings from Home Assistant.\n\n### Currently Implemented\n- ✅ DNS Cache enable/disable (\\`cache_enabled\\` - v0.107.65+)\n\n### Not Yet Implemented\n| Feature | API Field | Description |\n|---------|-----------|-------------|\n| DNS-over-HTTPS | \\`upstream_dns\\` | Configure DoH upstreams |\n| DNSSEC | \\`dnssec_enabled\\` | Enable/disable DNSSEC validation |\n| Blocking Mode | \\`blocking_mode\\` | default/refused/nxdomain/null_ip/custom_ip |\n| EDNS Client Subnet | \\`edns_cs_enabled\\` | Send client subnet to upstreams |\n| Rate Limit | \\`rate_limit\\` | Requests per second limit |\n| Cache TTL Min/Max | \\`cache_ttl_min\\`, \\`cache_ttl_max\\` | Override TTL bounds |\n\n### Implementation Approach\n1. Add new switch entities for boolean options (DNSSEC, EDNS CS)\n2. Add select entities for blocking_mode\n3. Add number entities for rate_limit, cache_ttl values\n4. Update coordinator to fetch dns_info on each poll (already done)\n\n### API Reference\n- Endpoint: \\`GET /control/dns_info\\`, \\`POST /control/dns_config\\`\n- Available since: AdGuard Home v0.100+\n- Source: AdGuard Home OpenAPI spec at /openapi/openapi.yaml","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T19:55:56.396645-05:00","updated_at":"2025-12-17T20:06:27.569106-05:00","closed_at":"2025-12-17T20:06:27.569106-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-xuu","depends_on_id":"homeassistant_adguard_home-mcg","type":"blocks","created_at":"2025-12-17T19:57:24.306074-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-xuu","depends_on_id":"homeassistant_adguard_home-qla","type":"blocks","created_at":"2025-12-17T19:57:30.491779-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-xv3","title":"Add contract tests validating models against OpenAPI spec","description":"## Rationale\nTo ensure ongoing compliance with the AdGuard Home API, implement contract tests that validate our models against the OpenAPI specification.\n\n## File Locations\n- **OpenAPI Spec**: Download from https://github.com/AdguardTeam/AdGuardHome/blob/master/openapi/openapi.yaml\n- **Models to Test**: \\`custom_components/adguard_home_extended/api/models.py\\`\n- **New Test File**: \\`tests/test_openapi_contract.py\\` (create new)\n- **Dependencies**: May need \\`openapi-core\\` or \\`pyyaml\\` in pyproject.toml\n\n## Approach Options\n\n### Option 1: Schema Validation with openapi-core\n\\`\\`\\`python\nfrom openapi_core import OpenAPI\nfrom openapi_core.validation.response import V31ResponseValidator\n\n# Load spec and validate responses match schema\napi = OpenAPI.from_file('openapi.yaml')\nvalidator = V31ResponseValidator(api)\n\\`\\`\\`\n\n### Option 2: Manual YAML-based Testing\n\\`\\`\\`python\nimport yaml\nimport pytest\n\n@pytest.fixture\ndef openapi_spec():\n    with open('tests/fixtures/openapi.yaml') as f:\n        return yaml.safe_load(f)\n\ndef test_status_model_matches_schema(openapi_spec):\n    schema = openapi_spec['components']['schemas']['ServerStatus']\n    # Verify AdGuardHomeStatus has all required fields\n    ../..\n\\`\\`\\`\n\n### Option 3: Property-Based Testing with Hypothesis\nGenerate random valid API responses from schema and verify models parse them.\n\n## Implementation Plan\n1. Download and pin specific OpenAPI spec version to \\`tests/fixtures/openapi.yaml\\`\n2. Create \\`tests/test_openapi_contract.py\\`\n3. For each model, validate:\n   - All required fields present in dataclass\n   - Field types match schema (str, int, bool, list, etc.)\n   - Optional fields have default values\n4. Add to CI pipeline (pytest runs automatically)\n\n## Acceptance Criteria\n- [ ] OpenAPI spec pinned to specific version in tests/fixtures/\n- [ ] Contract tests for Status, Stats, Client, FilteringStatus, QueryLogEntry models\n- [ ] Tests fail if model drifts from schema (missing required field)\n- [ ] Tests pass with \\`pytest tests/test_openapi_contract.py -v\\`\n- [ ] Add any new test dependencies to pyproject.toml","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:22:54.00328-05:00","updated_at":"2025-12-17T20:28:23.780824-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-xv3","depends_on_id":"homeassistant_adguard_home-elu","type":"blocks","created_at":"2025-12-17T20:23:31.948096-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-xv3","depends_on_id":"homeassistant_adguard_home-iwx","type":"blocks","created_at":"2025-12-17T20:23:31.991876-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-xv3","depends_on_id":"homeassistant_adguard_home-wa7","type":"blocks","created_at":"2025-12-17T20:23:32.037711-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-xv3","depends_on_id":"homeassistant_adguard_home-rjb","type":"blocks","created_at":"2025-12-17T20:23:32.078107-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-xv3","depends_on_id":"homeassistant_adguard_home-yij","type":"blocks","created_at":"2025-12-17T20:24:48.555301-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-y7f","title":"Implement statistics configuration API","description":"## Gap Identified\nStatistics configuration endpoints exist in OpenAPI but are not implemented.\n\n## Missing Endpoints\n- GET /control/stats/config - Get statistics configuration\n- PUT /control/stats/config/update - Update statistics config\n- POST /control/stats/reset - Reset all statistics\n\n## OpenAPI Schema Reference\n\\`\\`\\`yaml\n/control/stats/config:\n  get:\n    summary: Get statistics configuration\n    responses:\n      200:\n        content:\n          application/json:\n            schema:\n              \\ref: '#/components/schemas/StatsConfig'\n\nStatsConfig:\n  type: object\n  properties:\n    enabled:\n      type: boolean\n    interval:\n      type: number\n      description: Statistics retention in hours\n    ignored:\n      type: array\n      items:\n        type: string\n      description: List of hosts to ignore from stats\n\\`\\`\\`\n\n## Value for HA Integration\n- Switch to enable/disable statistics collection\n- Sensor for retention period\n- Service to reset statistics\n- Useful for privacy-conscious users\n\n## Acceptance Criteria\n- [ ] Create StatsConfig model\n- [ ] Implement get_stats_config() method\n- [ ] Implement set_stats_config() method\n- [ ] Implement reset_stats() method\n- [ ] Add unit tests","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-17T20:22:43.279543-05:00","updated_at":"2025-12-17T20:22:43.279543-05:00"}
{"id":"homeassistant_adguard_home-yge","title":"Add DNS configuration API endpoints for cache control","description":"## Background\nAdGuard Home v0.107.65+ added explicit DNS cache control via new API fields:\n- \\`GET /control/dns_info\\` - includes new \\`cache_enabled\\` boolean field\n- \\`POST /control/dns_config\\` - accepts \\`cache_enabled\\` to toggle cache without losing size config\n\n## Current State\nThe integration only has \\`API_FILTERING_CONFIG = /control/filtering/config\\` which is for filtering settings, not DNS configuration.\n\n## Required Changes\n1. Add constants to \\`const.py\\`:\n\\`\\`\\`python\nAPI_DNS_INFO: Final = \"/control/dns_info\"\nAPI_DNS_CONFIG: Final = \"/control/dns_config\"\n\\`\\`\\`\n\n2. Add client methods:\n\\`\\`\\`python\nasync def get_dns_info(self) -\u003e dict:\n    return await self._get(API_DNS_INFO)\n\nasync def set_dns_config(self, config: dict) -\u003e None:\n    await self._post(API_DNS_CONFIG, config)\n\\`\\`\\`\n\n3. Optionally add a switch for DNS cache enable/disable\n\n## Research Source\nAdGuard Home CHANGELOG v0.107.65: 'A new cache_enabled field to the HTTP API (GET /control/dns_info and POST /control/dns_config)'","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-17T18:16:07.553447-05:00","updated_at":"2025-12-17T18:27:12.258474-05:00","closed_at":"2025-12-17T18:27:12.258474-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-yge","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:17:52.265555-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-yij","title":"Update QueryLogEntry model to match OpenAPI schema","description":"## Gap Identified\nThe QueryLogEntry model is missing several fields that provide useful context about DNS queries.\n\n## File Locations\n- **Models File**: \\`custom_components/adguard_home_extended/api/models.py\\`\n- **Model Class**: \\`QueryLogEntry\\` dataclass\n- **Test File**: \\`tests/test_models.py\\`\n- **API Client Usage**: \\`custom_components/adguard_home_extended/api/client.py\\` - \\`get_query_log()\\` method\n\n## Current Model Fields\n- time\n- client\n- client_id  \n- question (domain, type)\n- answer\n- reason\n- status\n- upstream\n- elapsed_ms\n\n## Missing Fields (per OpenAPI)\n- \\`client_info\\` (object) - Detailed client information:\n  - \\`name\\` (string) - Client name if known\n  - \\`whois\\` (object) - WHOIS information\n  - \\`disallowed\\` (boolean) - Whether client is disallowed\n  - \\`disallowed_rule\\` (string) - Rule that disallowed\n- \\`answer_dnssec\\` (boolean) - Whether response was DNSSEC validated\n- \\`cached\\` (boolean) - Whether response was from cache\n- \\`rules\\` (array) - List of rules that matched:\n  - \\`filter_list_id\\` (integer)\n  - \\`text\\` (string) - Rule text\n- \\`original_answer\\` (array) - Original upstream answer before filtering\n- \\`service_name\\` (string) - Blocked service name if applicable\n\n## OpenAPI Schema Reference\n\\`\\`\\`yaml\nQueryLogItem:\n  type: object\n  properties:\n    time:\n      type: string\n      format: date-time\n    client:\n      type: string\n    client_info:\n      \\ref: '#/components/schemas/QueryLogItemClient'\n    answer_dnssec:\n      type: boolean\n    cached:\n      type: boolean\n    rules:\n      type: array\n      items:\n        \\ref: '#/components/schemas/ResultRule'\n    service_name:\n      type: string\n    original_answer:\n      type: array\n      items:\n        \\ref: '#/components/schemas/DnsAnswer'\n\nResultRule:\n  type: object\n  properties:\n    filter_list_id:\n      type: integer\n    text:\n      type: string\n\\`\\`\\`\n\n## Acceptance Criteria\n- [ ] Create \\`QueryLogClientInfo\\` dataclass for client_info\n- [ ] Create \\`ResultRule\\` dataclass for rules array items\n- [ ] Add \\`client_info: QueryLogClientInfo | None = None\\` field\n- [ ] Add \\`answer_dnssec: bool = False\\` field\n- [ ] Add \\`cached: bool = False\\` field\n- [ ] Add \\`rules: list[ResultRule] = field(default_factory=list)\\` field\n- [ ] Add \\`service_name: str | None = None\\` field\n- [ ] Update \\`from_dict()\\` parsing\n- [ ] Add tests in test_models.py\n- [ ] Tests pass with \\`pytest tests/test_models.py -v\\`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T20:21:59.81266-05:00","updated_at":"2025-12-17T20:27:41.843899-05:00"}
{"id":"homeassistant_adguard_home-yns","title":"Switch entities - protection toggles","description":"Create switch.py with switches for: global protection, safe browsing, parental control, safe search enforcement","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T15:52:42.110974-05:00","updated_at":"2025-12-17T16:00:31.833492-05:00","closed_at":"2025-12-17T16:00:31.833492-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-yns","depends_on_id":"homeassistant_adguard_home-0d8","type":"parent-child","created_at":"2025-12-17T15:53:38.791167-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-yns","depends_on_id":"homeassistant_adguard_home-5k9","type":"blocks","created_at":"2025-12-17T15:53:47.392432-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-z0n","title":"Add Filter List Enable/Disable Controls","description":"## Rationale\nCurrently the integration can add/remove filter URLs but cannot enable/disable individual filter lists without removing them. This is useful for:\n- Temporarily disabling a problematic filter\n- A/B testing different filter lists\n- Quick troubleshooting of blocking issues\n\n### Current Implementation\n- ✅ \\`add_filter_url\\` service - adds new filter list\n- ✅ \\`remove_filter_url\\` service - removes filter list\n- ❌ No way to toggle existing filter enabled state\n\n### Required API\n\\`\\`\\`\nPOST /control/filtering/set_url\n{\n  \"url\": \"https://example.com/filter.txt\",\n  \"data\": {\n    \"enabled\": false,\n    \"name\": \"My Filter\",\n    \"url\": \"https://example.com/filter.txt\"\n  }\n}\n\\`\\`\\`\n\n### Implementation\n1. Add service: \\`adguard_home_extended.set_filter_enabled\\`\n   - Parameters: url (required), enabled (required)\n2. Consider adding switch entities per filter list\n   - Dynamic creation based on filtering.filters data\n   - Toggle enabled state\n\n### Considerations\n- Filter lists can have long URLs - need good UI for selection\n- Should refresh filter data after state change\n- Watch for rate limiting if many filters toggled quickly","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T19:56:56.60574-05:00","updated_at":"2025-12-17T20:13:56.630296-05:00","closed_at":"2025-12-17T20:13:56.630296-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-z0n","depends_on_id":"homeassistant_adguard_home-mcg","type":"blocks","created_at":"2025-12-17T19:57:24.528061-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-z0n","depends_on_id":"homeassistant_adguard_home-qla","type":"blocks","created_at":"2025-12-17T19:57:30.61266-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-zd6","title":"Add Query Log and Stats Management Services","description":"## Rationale\nAdGuard Home provides APIs for managing query log and statistics that would be useful for automations:\n- Clear query log after backup\n- Reset stats at the start of each month\n- Toggle query logging for privacy\n\n### APIs Not Yet Exposed\n| Endpoint | Method | Purpose |\n|----------|--------|---------|\n| \\`/control/querylog_clear\\` | POST | Clear all query log entries |\n| \\`/control/stats_reset\\` | POST | Reset all statistics |\n| \\`/control/querylog/config/update\\` | PUT | Enable/disable query logging |\n| \\`/control/stats/config/update\\` | PUT | Enable/disable statistics |\n\n### Implementation\n1. Add new services:\n   - \\`adguard_home_extended.clear_query_log\\`\n   - \\`adguard_home_extended.reset_stats\\`\n   - \\`adguard_home_extended.set_query_log_enabled\\`\n   - \\`adguard_home_extended.set_stats_enabled\\`\n\n2. Add switch entities:\n   - Query Logging enabled/disabled\n   - Statistics collection enabled/disabled\n\n### Use Cases\n- Monthly stats reset automation\n- Privacy mode: disable query logging temporarily\n- Maintenance: clear logs before backup to reduce size\n\n### API Reference\n- Query log config: \\`GET/PUT /control/querylog/config\\`\n- Stats config: \\`GET/PUT /control/stats/config\\`\n- Available since: AdGuard Home v0.107.30+","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T19:56:44.824053-05:00","updated_at":"2025-12-17T20:20:37.029928-05:00","closed_at":"2025-12-17T20:20:37.029928-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-zd6","depends_on_id":"homeassistant_adguard_home-mcg","type":"blocks","created_at":"2025-12-17T19:57:24.488727-05:00","created_by":"daemon"},{"issue_id":"homeassistant_adguard_home-zd6","depends_on_id":"homeassistant_adguard_home-qla","type":"blocks","created_at":"2025-12-17T19:57:30.574577-05:00","created_by":"daemon"}]}
{"id":"homeassistant_adguard_home-zfs","title":"Expand DhcpStatus model with missing API fields","description":"## Background\nThe current \\`DhcpStatus\\` model in \\`models.py:177-195\\` is missing several fields that the AdGuard Home API returns.\n\n## Current Model\n\\`\\`\\`python\n@dataclass\nclass DhcpStatus:\n    enabled: bool = False\n    interface_name: str = \"\"\n    leases: list[DhcpLease] = field(default_factory=list)\n    static_leases: list[DhcpLease] = field(default_factory=list)\n\\`\\`\\`\n\n## Missing Fields\nFrom the AdGuard Home API \\`GET /control/dhcp/status\\`:\n- \\`v4\\` - IPv4 DHCP configuration object:\n  - \\`gateway_ip\\`\n  - \\`subnet_mask\\`\n  - \\`range_start\\`\n  - \\`range_end\\`\n  - \\`lease_duration\\`\n- \\`v6\\` - IPv6 DHCP configuration object:\n  - \\`range_start\\`\n  - \\`lease_duration\\`\n\n## Required Changes\n1. Create \\`DhcpV4Config\\` and \\`DhcpV6Config\\` dataclasses\n2. Add these to \\`DhcpStatus\\`:\n\\`\\`\\`python\n@dataclass\nclass DhcpStatus:\n    enabled: bool = False\n    interface_name: str = \"\"\n    v4: DhcpV4Config | None = None\n    v6: DhcpV6Config | None = None\n    leases: list[DhcpLease] = field(default_factory=list)\n    static_leases: list[DhcpLease] = field(default_factory=list)\n\\`\\`\\`\n\n3. Optionally expose DHCP configuration as sensors\n\n## Research Source\nAdGuard Home OpenAPI spec - dhcp/status endpoint returns full v4/v6 configuration","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T18:16:47.029551-05:00","updated_at":"2025-12-17T18:28:12.717239-05:00","closed_at":"2025-12-17T18:28:12.717239-05:00","dependencies":[{"issue_id":"homeassistant_adguard_home-zfs","depends_on_id":"homeassistant_adguard_home-53z","type":"blocks","created_at":"2025-12-17T18:17:57.24773-05:00","created_by":"daemon"}]}
